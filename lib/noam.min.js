(function(e){typeof module!="undefined"&&typeof module.exports!="undefined"&&(module.exports=e),typeof exports!="undefined"&&typeof exports!="function"&&(exports.noam=e),typeof define=="function"&&define.amd&&define("noam",[],function(){return e}),typeof window!="undefined"&&(window.noam=e)})(function(){var e={};return e.util={},e.util.areEquivalent=function(t,n){if(typeof t=="undefined"||typeof n=="undefined")return!1;if(t===n)return!0;if(t instanceof Object&&n instanceof Object){if(t.constructor!==n.constructor)return!1;for(var r in t){if(!t.hasOwnProperty(r))continue;if(!n.hasOwnProperty(r))return!1;if(t[r]===n[r])continue;if(typeof t[r]!="object")return!1;if(!e.util.areEquivalent(t[r],n[r]))return!1}for(r in n)if(n.hasOwnProperty(r)&&!t.hasOwnProperty(r))return!1;return!0}return!1},e.util.contains=function(t,n,r){r=r?r:0;for(var i=r;i<t.length;i++)if(e.util.areEquivalent(t[i],n))return!0;return!1},e.util.index=function(t,n,r){var i=r||0;while(i<t.length){if(e.util.areEquivalent(t[i],n))return i;i++}return-1},e.util.containsAll=function(t,n){for(var r=0;r<n.length;r++)if(!e.util.contains(t,n[r]))return!1;return!0},e.util.containsAny=function(t,n){for(var r=0;r<n.length;r++)if(e.util.contains(t,n[r]))return!0;return!1},e.util.areEqualSets=function(t,n){if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(!e.util.contains(n,t[r]))return!1;return!0},e.util.containsSet=function(t,n){for(var r=0;r<t.length;r++)if(e.util.areEqualSets(t[r],n))return!0;return!1},e.util.setUnion=function(t,n){var r=[],i;for(i=0;i<t.length;i++)e.util.contains(r,t[i])||r.push(t[i]);for(i=0;i<n.length;i++)e.util.contains(r,n[i])||r.push(n[i]);return r},e.util.setIntersection=function(t,n){var r=[],i;for(i=0;i<t.length;i++)e.util.contains(n,t[i])&&r.push(t[i]);return r},e.util.clone=function(e){return JSON.parse(JSON.stringify(e))},e.util.makeCounter=function(){function e(){return this.value++}function t(t){return{value:t,getAndAdvance:e}}return t}(),e.util.randint=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},function(){function o(e){return Object.prototype.toString.call(e)==="[object Array]"}function u(e){e=Math.max(e,t[0]),e=Math.min(e,t[t.length-1]);var n=0,r=t.length-1,i;while(n<r)i=n+Math.floor((r-n)/2),t[i]>=e?r=i:n=i+1;return n}function a(e){var t,n;if(e===undefined)return 12345;if(e===null)return 54321;if(typeof e=="boolean"||typeof e=="number")return e&r;if(typeof e=="string"){t=5381;for(n=0;n<e.length;n++)t=(t*33^e.charCodeAt(n))&r;return t}if(o(e)){t=6421;for(n=0;n<e.length;n++)t=(t*37^a(e[n]))&r;return t}var i=[];for(n in e){if(!e.hasOwnProperty(n))continue;i.push(n)}i.sort(),t=3203;for(n=0;n<i.length;n++)t=((t*39^a(i[n]))*43^a(e[i[n]]))&r;return t}function f(e,n){if(n>=t.length)throw new Error("Capacity of HashTable can't grow beyond "+t[t.length-1]);if(n>=0){var r=e.capacity,i=e.keys,s=e.values,o=e.numkeys;e.capacity_index=n,e.capacity=t[n],e.keys=[],e.values=[],e.numkeys=0;for(var u=0;u<r;u++)i[u]!==undefined&&e.put(i[u],s[u])}}function l(e,t){var n=e.hash(t)%e.capacity;while(e.keys[n]!==undefined&&!e.equals(t,e.keys[n]))++n==e.capacity&&(n=0);return n}function h(e){this.idx=0,this.H=e}function p(e){this.idx=0,this.H=e}function d(e){this.idx=0,this.H=e}var t=[5,11,23,47,97,197,397,797,1597,3203,6421,12853,25717,51437,102877,205759,411527,823117,1646237,3292489,6584983],n=0,r=(1<<31)-1,i=.75,s=.25;e.util.HashTable=function(e){this.capacity_index=n,e&&(e.initial_capacity&&(this.capacity_index=u(e.initial_capacity)),e.hash&&(this.hash=e.hash),e.equals&&(this.equals=e.equals)),this.capacity=t[this.capacity_index],this.numkeys=0,this.keys=[],this.values=[]},e.util.HashTable.prototype.hash=a,e.util.HashTable.prototype.equals=e.util.areEquivalent,e.util.HashTable.prototype.loadFactor=function(){return this.numkeys/this.capacity},e.util.HashTable.prototype.put=function(e,t){if(e===undefined)throw new Error("called HashTable.put with key === undefined");var n=l(this,e);this.keys[n]===undefined&&++this.numkeys,this.keys[n]=e,this.values[n]=t,this.loadFactor()>i&&f(this,this.capacity_index+1)},e.util.HashTable.prototype.get=function(e){if(e===undefined)throw new Error("called HashTable.get with key === undefined");var t=l(this,e);return this.values[t]},e.util.HashTable.prototype.remove=function(e){if(e===undefined)throw new Error("called HashTable.remove with key === undefined");var t=l(this,e);if(this.keys[t]===undefined)return;this.keys[t]=this.values[t]=undefined,--this.numkeys,this.loadFactor()<s&&f(this,this.capacity_index-1)},e.util.HashTable.prototype.isEmpty=function(){return this.numkeys===0},e.util.HashTable.prototype.clear=function(){this.capacity_index=n,this.capacity=t[this.capacity_index],this.numkeys=0,this.keys=[],this.values=[]},e.util.HashTable.prototype.size=function(){return this.numkeys},e.util.HashTable.prototype.containsKey=function(e){return this.get(e)===undefined};var c={hasNext:function(){while(this.idx<this.H.capacity&&this.H.keys[this.idx]===undefined)++this.idx;return this.H.keys[this.idx]!==undefined},_next:function(e,t){if(!this.hasNext())throw new Error(e);var n=t(this);return++this.idx,n}};h.prototype=Object.create(c),h.prototype.next=function(){return this._next("KeyIterator.next called on empty iterator",function(e){return e.H.keys[e.idx]})},p.prototype=Object.create(c),p.prototype.next=function(){return this._next("ValueIterator.next called on empty iterator",function(e){return e.H.values[e.idx]})},d.prototype=Object.create(c),d.prototype.next=function(){return this._next("KeyValueIterator.next called on empty iterator",function(e){return[e.H.keys[e.idx],e.H.values[e.idx]]})},e.util.HashTable.prototype.keyIterator=function(){return new h(this)},e.util.HashTable.prototype.valueIterator=function(){return new p(this)},e.util.HashTable.prototype.keyValueIterator=function(){return new d(this)}}(),e.fsm={},e.fsm.epsilonSymbol="$",e.fsm.dfaType="DFA",e.fsm.nfaType="NFA",e.fsm.enfaType="eNFA",e.fsm.makeNew=function(){return{states:[],alphabet:[],acceptingStates:[],initialState:undefined,transitions:[]}},e.fsm._addStateOrSymbol=function(t,n,r,i){if(n===undefined)throw new Error(r);if(e.util.contains(t,n))throw new Error(i);return t.push(n),n},e.fsm.addState=function(t,n){return e.fsm._addStateOrSymbol(t.states,n,"No state object specified","State already exists")},e.fsm.addSymbol=function(t,n){if(e.util.areEquivalent(n,e.fsm.epsilonSymbol))throw new Error("Can't add the epsilon symbol to the alphabet");return e.fsm._addStateOrSymbol(t.alphabet,n,"No symbol object specified","Symbol already exists")},e.fsm.addAcceptingState=function(t,n){if(!e.util.contains(t.states,n))throw new Error("The specified object is not a state of the FSM");e.fsm._addStateOrSymbol(t.acceptingStates,n,"","The specified state is already accepting")},e.fsm.setInitialState=function(t,n){if(!e.util.contains(t.states,n))throw new Error("The specified object is not a state of the FSM");t.initialState=n},e.fsm._addTransition=function(t,n,r,i){if(!Array.isArray(r))throw new Error("The toStates argument must be an array");if(!e.util.contains(t.states,n)||!e.util.containsAll(t.states,r))throw new Error("One of the specified objects is not a state of the FSM");var s,o=!1;for(s=0;s<t.transitions.length;s++)if(e.util.areEquivalent(n,t.transitions[s].fromState)&&e.util.areEquivalent(i,t.transitions[s].transitionSymbol)){t.transitions[s].toStates=e.util.setUnion(t.transitions[s].toStates,r),o=!0;break}o||t.transitions.push({fromState:n,toStates:r,symbol:i})},e.fsm.addTransition=function(t,n,r,i){if(!e.util.contains(t.alphabet,i))throw new Error("The specified object is not an alphabet symbol of the FSM");e.fsm._addTransition(t,n,r,i)},e.fsm.addEpsilonTransition=function(t,n,r){e.fsm._addTransition(t,n,r,e.fsm.epsilonSymbol)},e.fsm.validate=function(t){var n,r,i;if(!(typeof t!="undefined"&&Array.isArray(t.states)&&Array.isArray(t.alphabet)&&Array.isArray(t.acceptingStates)&&typeof t.initialState!="undefined"&&t.initialState!==null&&Array.isArray(t.transitions)))throw new Error("FSM must be defined and have states, alphabet, acceptingStates, initialState and transitions array properties!");if(t.states.length<1)throw new Error("Set of states must not be empty.");for(n=0;n<t.states.length;n++)if(e.util.contains(t.states,t.states[n],n+1))throw new Error("Equivalent states");if(t.alphabet.length<1)throw new Error("Alphabet must not be empty.");for(n=0;n<t.alphabet.length;n++)if(e.util.contains(t.alphabet,t.alphabet[n],n+1))throw new Error("Equivalent alphabet symbols");if(e.util.contains(t.alphabet,e.fsm.epsilonSymbol))throw new Error("FSM alphabet must not contain the epsilon symbol");for(n=0;n<t.alphabet.length;n++)if(e.util.contains(t.states,t.alphabet[n]))throw new Error("States and alphabet symbols must not overlap");for(n=0;n<t.acceptingStates.length;n++){if(e.util.contains(t.acceptingStates,t.acceptingStates[n],n+1))throw new Error("Equivalent acceptingStates");if(!e.util.contains(t.states,t.acceptingStates[n]))throw new Error("Each accepting state must be in states")}if(!e.util.contains(t.states,t.initialState))throw new Error("Initial state must be in states");for(n=0;n<t.transitions.length;n++){var s=t.transitions[n];if(typeof s.fromState=="undefined"||typeof s.toStates=="undefined"||typeof s.symbol=="undefined")throw new Error("Transitions must have fromState, toState and symbol");if(!e.util.contains(t.states,s.fromState))throw new Error("Transition fromState must be in states.");if(!e.util.contains(t.alphabet,s.symbol)&&s.symbol!==e.fsm.epsilonSymbol)throw new Error("Transition symbol must be in alphabet.");for(i=0;i<s.toStates.length;i++){if(!e.util.contains(t.states,s.toStates[i]))throw new Error("Transition toStates must be in states.");if(e.util.contains(s.toStates,s.toStates[i],i+1))throw new Error("Transition toStates must not contain duplicates.")}}for(n=0;n<t.transitions.length;n++)for(r=n+1;r<t.transitions.length;r++)if(t.transitions[n].fromState===t.transitions[r].fromState&&t.transitions[n].symbol===t.transitions[r].symbol)throw new Error("Transitions for the same fromState and symbol must be defined in a single trainsition.");return!0},e.fsm.isAcceptingState=function(t,n){return e.util.contains(t.acceptingStates,n)},e.fsm.determineType=function(t){var n=e.fsm.dfaType;for(var r=0;r<t.transitions.length;r++){var i=t.transitions[r];if(i.toStates.length===0||i.toStates.length>1)n=e.fsm.nfaType;else if(i.symbol===e.fsm.epsilonSymbol){n=e.fsm.enfaType;break}}return n===e.fsm.dfaType&&t.transitions.length<t.states.length*t.alphabet.length&&(n=e.fsm.nfaType),n},e.fsm.computeEpsilonClosure=function(t,n){if(!e.util.containsAll(t.states,n))throw new Error("FSM must contain all states for which epsilon closure is being computed");var r=n,i=[];while(r.length!==0){var s=r.pop();i.push(s);for(var o=0;o<t.transitions.length;o++){var u=t.transitions[o];if(u.symbol===e.fsm.epsilonSymbol&&e.util.areEquivalent(u.fromState,s))for(var a=0;a<u.toStates.length;a++){if(e.util.contains(i,u.toStates[a])||e.util.contains(r,u.toStates[a]))continue;r.push(u.toStates[a])}}}return i},e.fsm.makeSimpleTransition=function(t,n,r){if(!e.util.containsAll(t.states,n))throw new Error("FSM must contain all states for which the transition is being computed");if(!e.util.contains(t.alphabet,r))throw new Error("FSM must contain input symbol for which the transition is being computed");var i=[];for(var s=0;s<t.transitions.length;s++){var o=t.transitions[s];if(e.util.areEquivalent(t.transitions[s].symbol,r)&&e.util.contains(n,o.fromState))for(var u=0;u<o.toStates.length;u++)e.util.contains(i,o.toStates[u])||i.push(o.toStates[u])}return i},e.fsm.makeTransition=function(t,n,r){if(!e.util.containsAll(t.states,n))throw new Error("FSM must contain all states for which the transition is being computed");if(!e.util.contains(t.alphabet,r))throw new Error("FSM must contain input symbol for which the transition is being computed");var i=e.util.clone(n);return i=e.fsm.computeEpsilonClosure(t,i),i=e.fsm.makeSimpleTransition(t,i,r),i=e.fsm.computeEpsilonClosure(t,i),i},e.fsm.readString=function(t,n){if(!e.util.containsAll(t.alphabet,n))throw new Error("FSM must contain all symbols for which the transition is being computed");var r=e.fsm.computeEpsilonClosure(t,[t.initialState]);for(var i=0;i<n.length;i++)r=e.fsm.makeTransition(t,r,n[i]);return r},e.fsm.transitionTrail=function(t,n,r){if(!e.util.containsAll(t.alphabet,r))throw new Error("FSM must contain all symbols for which the transition is being computed");var i=[n],s=[e.util.clone(i)];for(var o=0;o<r.length;o++)i=e.fsm.makeTransition(t,i,r[o]),s.push(e.util.clone(i));return s},e.fsm.isStringInLanguage=function(t,n){var r=e.fsm.readString(t,n);return e.util.containsAny(t.acceptingStates,r)},e.fsm.printTable=function(t){var n=require("cli-table"),r=[""].concat(t.alphabet);e.fsm.determineType(t)===e.fsm.enfaType&&r.push(e.fsm.epsilonSymbol),r.push("");var i=new n({head:r,chars:{top:"-","top-mid":"+","top-left":"+","top-right":"+",bottom:"-","bottom-mid":"+","bottom-left":"+","bottom-right":"+",left:"|","left-mid":"+",mid:"-","mid-mid":"+",right:"|","right-mid":"+"},truncate:"~"}),s=[],o,u;for(o=0;o<t.states.length;o++){s.push(new Array(r.length));for(u=0;u<r.length;u++)s[o][u]="";s[o][0]=t.states[o].toString(),s[o][r.length-1]=e.util.contains(t.acceptingStates,t.states[o])?"1":"0",i.push(s[o])}for(o=0;o<t.transitions.length;o++){var a=t.transitions[o],f=null,l=null;for(u=0;u<t.states.length;u++)if(e.util.areEquivalent(t.states[u],a.fromState)){l=u;break}if(a.symbol===e.fsm.epsilonSymbol)f=r.length-2;else for(u=0;u<t.alphabet.length;u++)if(e.util.areEquivalent(t.alphabet[u],a.symbol)){f=u+1;break}typeof s[l][f].text=="undefined"&&(s[l][f]={text:[]}),s[l][f].text.push(a.toStates)}return i.toString()},e.fsm.printHtmlTable=function(t){var n=[""].concat(t.alphabet);e.fsm.determineType(t)===e.fsm.enfaType&&n.push(e.fsm.epsilonSymbol),n.push("");var r=[],i,s;for(i=0;i<t.states.length;i++){r.push(new Array(n.length));for(s=0;s<n.length;s++)r[i][s]={text:[]};r[i][0]={text:t.states[i].toString()},r[i][n.length-1]=e.util.contains(t.acceptingStates,t.states[i])?{text:["1"]}:{text:["0"]}}for(i=0;i<t.transitions.length;i++){var o=t.transitions[i],u=null,a=null;for(s=0;s<t.states.length;s++)if(e.util.areEquivalent(t.states[s],o.fromState)){a=s;break}if(o.symbol===e.fsm.epsilonSymbol)u=n.length-2;else for(s=0;s<t.alphabet.length;s++)if(e.util.areEquivalent(t.alphabet[s],o.symbol)){u=s+1;break}typeof r[a][u].text=="undefined"&&(r[a][u]={text:[]}),r[a][u].text.push(o.toStates)}var f=[];f.push("<table border='1'>"),f.push("  <tr>");for(i=0;i<n.length;i++)f.push("    <th>"+n[i].toString()+"</th>");f.push("  </tr>");for(i=0;i<r.length;i++){f.push("  <tr>");for(s=0;s<r[i].length;s++)f.push("    <td>"+r[i][s].text+"</td>");f.push("  </tr>")}return f.push("</table>"),f.join("\n")},e.fsm.printDotFormat=function(t){var n=["digraph finite_state_machine {","  rankdir=LR;"],r=["  node [shape = doublecircle];"],i,s,o,u;for(i=0;i<t.acceptingStates.length;i++)r.push(t.acceptingStates[i].toString());r.push(";"),n.push(r.join(" ")),n.push("  node [shape = circle];"),n.push("  secret_node [style=invis, shape=point];");var a=["  secret_node ->"];a.push(t.initialState.toString()),a.push("[style=bold];"),n.push(a.join(" "));var f=[];for(i=0;i<t.transitions.length;i++)for(s=0;s<t.transitions[i].toStates.length;s++){var l=null;for(o=0;o<f.length;o++)e.util.areEquivalent(f[o].fromState,t.transitions[i].fromState)&&e.util.areEquivalent(f[o].toStates,[t.transitions[i].toStates[s]])&&(l=f[o]);if(l===null){var c=e.util.clone(t.transitions[i]);c.symbol=[c.symbol],f.push(c)}else l.symbol.push(t.transitions[i].symbol)}for(i=0;i<f.length;i++)e.util.areEquivalent(f[i].toStates[0],t.initialState)?(u=[" "],u.push(f[i].toStates[0].toString()),u.push("->"),u.push(f[i].fromState.toString()),u.push("["),u.push("label ="),u.push('"'+f[i].symbol.toString()+'"'),u.push(" dir = back];"),n.push(u.join(" "))):(u=[" "],u.push(f[i].fromState.toString()),u.push("->"),u.push(f[i].toStates[0].toString()),u.push("["),u.push("label ="),u.push('"'+f[i].symbol.toString()+'"'),u.push(" ];"),n.push(u.join(" ")));return n.push("}"),n.join("\n").replace(/\$/g,"?")},e.fsm.getReachableStates=function(t,n,r){var i=[n],s,o,u=r?[n]:[];while(i.length!==0){var a=i.pop();for(s=0;s<t.transitions.length;s++){var f=t.transitions[s];if(e.util.areEquivalent(a,f.fromState))for(o=0;o<f.toStates.length;o++)e.util.contains(u,f.toStates[o])||(u.push(f.toStates[o]),e.util.contains(i,f.toStates[o])||i.push(f.toStates[o]))}}return u},e.fsm.removeUnreachableStates=function(t){var n=e.fsm.getReachableStates(t,t.initialState,!0),r=e.util.clone(t),i;r.states=[],r.acceptingStates=[],r.transitions=[];for(i=0;i<t.states.length;i++)e.util.contains(n,t.states[i])&&r.states.push(e.util.clone(t.states[i]));for(i=0;i<t.acceptingStates.length;i++)e.util.contains(n,t.acceptingStates[i])&&r.acceptingStates.push(e.util.clone(t.acceptingStates[i]));for(i=0;i<t.transitions.length;i++)e.util.contains(n,t.transitions[i].fromState)&&r.transitions.push(e.util.clone(t.transitions[i]));return r},e.fsm.areEquivalentStates=function(t,n,r,i){function s(t,n,r,i){var s=e.util.contains(t.acceptingStates,n),o=e.util.contains(r.acceptingStates,i);return s&&o||!s&&!o}if(e.fsm.determineType(t)!==e.fsm.dfaType||e.fsm.determineType(r)!==e.fsm.dfaType)throw new Error("FSMs must be DFAs");if(t.alphabet.length!==r.alphabet.length||!e.util.containsAll(t.alphabet,r.alphabet))throw new Error("FSM alphabets must be the same");if(!e.util.contains(t.states,n)||!e.util.contains(r.states,i))throw new Error("FSMs must contain states");var o=[[n,i]],u=[],a,f;while(o.length!==0){var l=o.pop();if(!s(t,l[0],r,l[1]))return!1;u.push(l);for(a=0;a<t.alphabet.length;a++)for(f=0;f<t.alphabet.length;f++){var c=[e.fsm.makeTransition(t,[l[0]],t.alphabet[f])[0],e.fsm.makeTransition(r,[l[1]],t.alphabet[f])[0]];!e.util.contains(u,c)&&!e.util.contains(o,c)&&o.push(c)}}return!0},e.fsm.areEquivalentFSMs=function(t,n){return e.fsm.areEquivalentStates(t,t.initialState,n,n.initialState)},e.fsm.removeEquivalentStates=function(t){function a(t){for(var r=0;r<n.length;r++)if(e.util.areEquivalent(n[r][1],t))return!0;return!1}function f(t){for(var r=0;r<n.length;r++)if(e.util.areEquivalent(n[r][1],t))return n[r][0];return t}if(e.fsm.determineType(t)!==e.fsm.dfaType)throw new Error("FSM must be DFA");var n=[],r,i,s;for(r=0;r<t.states.length;r++)for(i=r+1;i<t.states.length;i++)if(e.fsm.areEquivalentStates(t,t.states[r],t,t.states[i])){var o=[t.states[r],t.states[i]];for(s=0;s<n.length;s++)if(e.util.areEquivalent(n[s][1],o[0])){o[0]=n[s][1];break}e.util.contains(n,o)||n.push(o)}var u={states:[],alphabet:e.util.clone(t.alphabet),initialState:[],acceptingStates:[],transitions:[]};for(r=0;r<t.states.length;r++)a(t.states[r])||u.states.push(e.util.clone(t.states[r]));for(r=0;r<t.acceptingStates.length;r++)a(t.acceptingStates[r])||u.acceptingStates.push(e.util.clone(t.acceptingStates[r]));u.initialState=e.util.clone(f(t.initialState));for(r=0;r<t.transitions.length;r++){var l=e.util.clone(t.transitions[r]);if(a(l.fromState))continue;for(i=0;i<l.toStates.length;i++)l.toStates[i]=f(l.toStates[i]);u.transitions.push(l)}return u},e.fsm.minimize=function(t){var n=e.fsm.determineType(t),r=t;n===e.fsm.nfaType?r=e.fsm.convertNfaToDfa(t):n===e.fsm.enfaType&&(r=e.fsm.convertEnfaToNfa(t),r=e.fsm.convertNfaToDfa(r));var i=e.fsm.removeUnreachableStates(r),s=e.fsm.removeEquivalentStates(i);return s},e.fsm.createRandomFsm=function(t,n,r,i){function f(e,t,n){var r=n;for(o=0;o<n.length-t;o++)r=e+n;return r}var s={},o,u,a;s.states=[];for(o=0,len=n.toString().length;o<n;o++)s.states.push("s"+f("0",len,o.toString()));s.alphabet=[];for(o=0,len=r.toString().length;o<r;o++)s.alphabet.push("a"+f("0",len,o.toString()));s.initialState=s.states[0],s.acceptingStates=[];for(o=0;o<n;o++)Math.round(Math.random())&&s.acceptingStates.push(s.states[o]);t===e.fsm.enfaType&&s.alphabet.push(e.fsm.epsilonSymbol),s.transitions=[];for(o=0;o<n;o++)for(u=0;u<s.alphabet.length;u++){var l=1;t!==e.fsm.dfaType&&(l=Math.floor(Math.random()*i));if(l>0){var c=[];for(a=0;a<s.states.length&&c.length<l;a++){var h=s.states.length-a-(l-c.length)+1;h<=0?h=1:h=1/h,Math.random()<=h&&c.push(s.states[a])}s.transitions.push({fromState:s.states[o],symbol:s.alphabet[u],toStates:c})}}return t===e.fsm.enfaType&&s.alphabet.pop(),s},e.fsm.convertNfaToDfa=function(t){var n=e.fsm.determineType(t);if(n===e.fsm.enfaType)throw new Error("FSM must be an NFA");if(n===e.fsm.dfaType)return t;var r={},i,s,o,u;r.alphabet=e.util.clone(t.alphabet),r.states=[],r.acceptingStates=[],r.initialState=[e.util.clone(t.initialState)],r.transitions=[];for(i=0;i<t.states.length;i++)r.states.push([e.util.clone(t.states[i])]);for(i=0;i<t.acceptingStates.length;i++)r.acceptingStates.push([e.util.clone(t.acceptingStates[i])]);var a=[],f=[];for(i=0;i<t.transitions.length;i++)u=e.util.clone(t.transitions[i]),u.fromState=[u.fromState],u.toStates=[u.toStates],u.toStates[0].length>1&&(e.util.containsSet(a,u.toStates[0])||a.push(u.toStates[0])),r.transitions.push(u);while(a.length!==0){var l=a.pop();r.states.push(l),e.util.containsAny(t.acceptingStates,l)&&r.acceptingStates.push(l);for(i=0;i<r.alphabet.length;i++){var c=e.fsm.makeTransition(t,l,r.alphabet[i]).sort();for(s=0;s<r.states.length;s++)if(e.util.areEqualSets(c,r.states[s])){c=r.states[s];break}for(s=0;s<a.length;s++)if(e.util.areEqualSets(c,a[s])){c=a[s];break}c.length>0&&r.transitions.push({fromState:l,symbol:r.alphabet[i],toStates:[c]}),!e.util.containsSet(r.states,c)&&!e.util.containsSet(a,c)&&c.length>1&&a.push(c)}}var h=!1,p="ERROR";for(i=0;i<r.states.length;i++)for(s=0;s<r.alphabet.length;s++){var d=!1;for(o=0;o<r.transitions.length;o++){u=r.transitions[o];if(e.util.areEquivalent(u.symbol,r.alphabet[s])&&e.util.areEquivalent(u.fromState,r.states[i])){d=!0;break}}d===!1&&(h===!1&&(r.states.push([p]),h=!0),r.transitions.push({fromState:r.states[i],symbol:r.alphabet[s],toStates:[[p]]}))}return r},e.fsm.convertEnfaToNfa=function(t){if(e.fsm.determineType(t)!==e.fsm.enfaType)return t;var n=e.util.clone(t),r,i,s=e.fsm.computeEpsilonClosure(t,[t.initialState]);e.util.containsAny(n.acceptingStates,s)&&!e.util.contains(n.acceptingStates,n.initialState)&&n.acceptingStates.push(n.initialState);var o=[];for(r=0;r<n.states.length;r++)for(i=0;i<n.alphabet.length;i++){var u=e.fsm.makeTransition(n,[n.states[r]],n.alphabet[i]).sort();u.length>0&&o.push({fromState:n.states[r],toStates:u,symbol:n.alphabet[i]})}n.transitions=o;var a=[];for(r=0;r<n.transitions.length;r++){var f=n.transitions[r];if(f.toStates.length>1){var l=!1;for(i=0;i<a.length;i++)if(e.util.areEqualSets(f.toStates,a[i])){f.toStates=a[i],l=!0;break}l===!1&&a.push(f.toStates)}}return n},e.fsm.isLanguageNonEmpty=function(t){var n=e.fsm.determineType(t),r=t;return n===e.fsm.nfaType?r=e.fsm.convertNfaToDfa(t):n===e.fsm.enfaType&&(r=e.fsm.convertEnfaToNfa(t),r=e.fsm.convertNfaToDfa(r)),r=e.fsm.minimize(r),r.acceptingStates.length>0},e.fsm.isLanguageInfinite=function(t){var n=e.fsm.determineType(t),r=t;n===e.fsm.nfaType?r=e.fsm.convertNfaToDfa(t):n===e.fsm.enfaType&&(r=e.fsm.convertEnfaToNfa(t),r=e.fsm.convertNfaToDfa(r)),r=e.fsm.minimize(r);var i=null,s,o;for(s=0;s<r.states.length;s++){if(e.util.contains(r.acceptingStates,r.states[s]))continue;o=e.fsm.getReachableStates(r,r.states[s],!0);if(e.util.containsAny(r.acceptingStates,o))continue;i=r.states[s];break}if(i===null)return!0;for(s=0;s<r.states.length;s++){if(e.util.areEquivalent(i,r.states[s]))continue;o=e.fsm.getReachableStates(r,r.states[s],!1);if(e.util.contains(o,r.states[s]))return!0}return!1},e.fsm.randomStringInLanguage=function(t){var n=e.fsm.determineType(t),r=t;n===e.fsm.nfaType?r=e.fsm.convertNfaToDfa(t):n===e.fsm.enfaType&&(r=e.fsm.convertEnfaToNfa(t),r=e.fsm.convertNfaToDfa(r)),r=e.fsm.minimize(r);if(r.acceptingStates.length===0)return null;var i=r.acceptingStates[Math.floor(Math.random()*r.acceptingStates.length)],s=[];for(;;){if(e.util.areEquivalent(i,r.initialState)===!0&&Math.round(Math.random()))break;var o=[],u;for(u=0;u<r.transitions.length;u++)e.util.areEquivalent(r.transitions[u].toStates[0],i)&&o.push(r.transitions[u]);if(o.length===0)break;var a=o[Math.floor(Math.random()*o.length)];s.push(a.symbol),i=a.fromState}return s.reverse(),s},e.fsm.randomStringNotInLanguage=function(t){var n=e.fsm.determineType(t),r=t;n===e.fsm.nfaType?r=e.fsm.convertNfaToDfa(t):n===e.fsm.enfaType&&(r=e.fsm.convertEnfaToNfa(t),r=e.fsm.convertNfaToDfa(r)),r=e.fsm.minimize(r);var i=[],s;for(s=0;s<r.states.length;s++)e.util.contains(r.acceptingStates,r.states[s])||i.push(r.states[s]);if(i.length===0)return null;var o=i[Math.floor(Math.random()*i.length)],u=[];for(;;){if(e.util.areEquivalent(o,r.initialState)===!0&&Math.round(Math.random()))break;var a=[];for(s=0;s<r.transitions.length;s++)e.util.areEquivalent(r.transitions[s].toStates[0],o)&&a.push(r.transitions[s]);if(a.length===0)break;var f=a[Math.floor(Math.random()*a.length)];u.push(f.symbol),o=f.fromState}return u.reverse(),u},e.fsm.union=function(t,n){if(!e.util.areEquivalent(t.alphabet,n.alphabet))throw new Error("Alphabets must be the same");var r={alphabet:e.util.clone(t.alphabet),states:[],initialState:[e.util.clone(t.initialState),e.util.clone(n.initialState)],acceptingStates:[],transitions:[]},i,s,o;for(i=0;i<t.states.length;i++)for(s=0;s<n.states.length;s++){var u=[e.util.clone(t.states[i]),e.util.clone(n.states[s])];r.states.push(u),(e.util.contains(t.acceptingStates,t.states[i])||e.util.contains(n.acceptingStates,n.states[s]))&&r.acceptingStates.push(u);for(o=0;o<r.alphabet.length;o++)r.transitions.push({fromState:u,symbol:r.alphabet[o],toStates:[[e.fsm.makeTransition(t,[t.states[i]],r.alphabet[o])[0],e.fsm.makeTransition(n,[n.states[s]],r.alphabet[o])[0]]]})}return r},e.fsm.intersection=function(t,n){var r=e.util.clone(e.util.setIntersection(t.alphabet,n.alphabet)),i={alphabet:r,states:[],initialState:[e.util.clone(t.initialState),e.util.clone(n.initialState)],acceptingStates:[],transitions:[]},s,o,u;for(s=0;s<t.states.length;s++)for(o=0;o<n.states.length;o++){var a=[e.util.clone(t.states[s]),e.util.clone(n.states[o])];i.states.push(a),e.util.contains(t.acceptingStates,t.states[s])&&e.util.contains(n.acceptingStates,n.states[o])&&i.acceptingStates.push(a);for(u=0;u<i.alphabet.length;u++)i.transitions.push({fromState:a,symbol:i.alphabet[u],toStates:[[e.fsm.makeTransition(t,[t.states[s]],i.alphabet[u])[0],e.fsm.makeTransition(n,[n.states[o]],i.alphabet[u])[0]]]})}return i},e.fsm.difference=function(t,n){if(!e.util.areEquivalent(t.alphabet,n.alphabet))throw new Error("Alphabets must be the same");var r={alphabet:e.util.clone(t.alphabet),states:[],initialState:[e.util.clone(t.initialState),e.util.clone(n.initialState)],acceptingStates:[],transitions:[]},i,s,o;for(i=0;i<t.states.length;i++)for(s=0;s<n.states.length;s++){var u=[e.util.clone(t.states[i]),e.util.clone(n.states[s])];r.states.push(u),e.util.contains(t.acceptingStates,t.states[i])&&!e.util.contains(n.acceptingStates,n.states[s])&&r.acceptingStates.push(u);for(o=0;o<r.alphabet.length;o++)r.transitions.push({fromState:u,symbol:r.alphabet[o],toStates:[[e.fsm.makeTransition(t,[t.states[i]],r.alphabet[o])[0],e.fsm.makeTransition(n,[n.states[s]],r.alphabet[o])[0]]]})}return r},e.fsm.complement=function(t){var n=e.util.clone(t),r=[],i;for(i=0;i<n.states.length;i++)e.util.contains(n.acceptingStates,n.states[i])||r.push(n.states[i]);return n.acceptingStates=r,n},e.fsm.concatenation=function(t,n){if(!e.util.areEquivalent(t.alphabet,n.alphabet))throw new Error("Alphabets must be the same");if(e.util.containsAny(t.states,n.states))throw new Error("States must not overlap");var r={alphabet:e.util.clone(t.alphabet),states:e.util.clone(t.states).concat(e.util.clone(n.states)),initialState:e.util.clone(t.initialState),acceptingStates:e.util.clone(n.acceptingStates),transitions:e.util.clone(t.transitions).concat(e.util.clone(n.transitions))};for(var i=0;i<t.acceptingStates.length;i++)r.transitions.push({fromState:e.util.clone(t.acceptingStates[i]),toStates:[e.util.clone(n.initialState)],symbol:e.fsm.epsilonSymbol});return r},e.fsm.kleene=function(t){var n=e.util.clone(t),r="NEW_INITIAL";n.states.push(r),n.transitions.push({fromState:r,toStates:[n.initialState],symbol:e.fsm.epsilonSymbol}),n.initialState=r;for(var i=0;i<n.acceptingStates.length;i++)n.transitions.push({fromState:n.acceptingStates[i],toStates:[r],symbol:e.fsm.epsilonSymbol});return n},e.fsm.reverse=function(t){var n=e.util.clone(t),r=[];for(var i=0;i<n.transitions.length;i++)for(var s=0;s<n.transitions[i].toStates.length;s++)r.push({fromState:n.transitions[i].toStates[s],toStates:[n.transitions[i].fromState],symbol:n.transitions[i].symbol});n.transitions=r;var o=n.acceptingStates;n.acceptingStates=[n.initialState];var u="NEW_INITIAL";return n.states.push(u),n.initialState=u,n.transitions.push({fromState:u,toStates:o,symbol:e.fsm.epsilonSymbol}),n},e.fsm.isSubset=function(t,n){var r=e.fsm.intersection(t,n);return e.fsm.areEquivalentFSMs(n,r)},e.fsm.grammar=function(t){var n={nonterminals:e.util.clone(t.states),terminals:e.util.clone(t.alphabet),initialNonterminal:e.util.clone(t.initialState),productions:[]},r;for(r=0;r<t.transitions.length;r++)t.transitions[r].symbol===e.fsm.epsilonSymbol?n.productions.push({left:[e.util.clone(t.transitions[r].fromState)],right:e.util.clone(t.transitions[r].toStates)}):n.productions.push({left:[e.util.clone(t.transitions[r].fromState)],right:[e.util.clone(t.transitions[r].symbol)].concat(e.util.clone(t.transitions[r].toStates))});for(r=0;r<t.acceptingStates.length;r++)n.productions.push({left:[e.util.clone(t.acceptingStates[r])],right:[e.grammar.epsilonSymbol]});return n},e.fsm.symbolsForTransitions=function(t,n,r){var i=[];for(var s=0;s<t.transitions.length;s++){var o=t.transitions[s];e.util.areEquivalent(o.fromState,n)&&e.util.contains(o.toStates,r)&&i.push(o.symbol)}return i},e.fsm.toRegex=function(t){var n=[],r=t.states.length,i,s,o,u;for(o=0;o<r+1;o++){n[o]=[];for(i=0;i<r;i++)n[o][i]=[]}for(i=0;i<r;i++)for(s=0;s<r;s++){var a=e.fsm.symbolsForTransitions(t,t.states[i],t.states[s]);for(u=0;u<a.length;u++)a[u]=e.re.tree.makeLit(a[u]);i===s&&a.push(e.re.tree.makeEps()),n[0][i][s]=e.re.tree.makeAlt(a)}for(o=1;o<r+1;o++)for(i=0;i<r;i++)for(s=0;s<r;s++)n[o][i][s]=e.re.tree.makeAlt([n[o-1][i][s],e.re.tree.makeSeq([n[o-1][i][o-1],e.re.tree.makeKStar(n[o-1][o-1][o-1]),n[o-1][o-1][s]])]);var f=-1,l=[];for(i=0;i<t.states.length;i++)e.util.areEquivalent(t.states[i],t.initialState)&&(f=i),e.util.contains(t.acceptingStates,t.states[i])&&l.push(i);var c=[];for(i=0;i<l.length;i++)c.push(n[r][f][l[i]]);return e.re.tree.makeAlt(c)},e.grammar={},e.grammar.epsilonSymbol="$",e.grammar.regType="regular",e.grammar.cfgType="context-free",e.grammar.csgType="context-sensitive",e.grammar.unrestrictedType="unrestricted",e.grammar.validate=function(t){if(!(typeof t!="undefined"&&Array.isArray(t.nonterminals)&&Array.isArray(t.terminals)&&typeof t.initialNonterminal!="undefined"&&t.initialNonterminal!==null&&Array.isArray(t.productions)))throw new Error("Grammar must be defined and have nonterminals, terminals, initialNonterminal and productions array properties!");var n,r;if(t.nonterminals.length<1)throw new Error("Set of nonterminals must not be empty.");if(t.terminals.length<1)throw new Error("Set of terminals must not be empty.");for(n=0;n<t.nonterminals.length;n++)if(e.util.contains(t.nonterminals,t.nonterminals[n],n+1))throw new Error("Equivalent nonterminals");for(n=0;n<t.terminals.length;n++)if(e.util.contains(t.terminals,t.terminals[n],n+1))throw new Error("Equivalent terminals");for(n=0;n<t.terminals.length;n++)if(e.util.contains(t.nonterminals,t.terminals[n]))throw new Error("Terminals and nonterminals must not overlap");if(!e.util.contains(t.nonterminals,t.initialNonterminal))throw new Error("InitialNonterminal must be in nonterminals");for(n=0;n<t.productions.length;n++){var i=t.productions[n];if(!Array.isArray(i.left))throw new Error("Left side of production must be an array");if(i.left.length===0)throw new Error("Left side of production must have at least one terminal or nonterminal");for(r=0;r<i.left.length;r++)if(!e.util.contains(t.nonterminals,i.left[r])&&!e.util.contains(t.terminals,i.left[r]))throw new Error("Left side of production must be in nonterminals or terminals");if(!Array.isArray(i.right))throw new Error("Right side of production must be an array");if(i.right.length!==1||i.right[0]!==e.grammar.epsilonSymbol){if(i.right.length===0)throw new Error("Right side of production must have at least one terminal or nonterminal or epsilon symbol");for(r=0;r<i.right.length;r++)if(!e.util.contains(t.nonterminals,i.right[r])&&!e.util.contains(t.terminals,i.right[r]))throw new Error("Right side of production must be in nonterminals or terminals")}if(e.util.contains(t.productions,i,n+1))throw new Error("Grammar must not have duplicate productions")}return!0},e.grammar.determineType=function(t){var n=e.grammar.regType,r=null,i,s,o;for(i=0;i<t.productions.length;i++){var u=t.productions[i];if(n===e.grammar.regType)if(u.left.length!==1||!e.util.contains(t.nonterminals,u.left[0]))n=e.grammar.cfgType;else{if(u.right.length===1)continue;var a=0;o=-1;for(s=0;s<u.right.length;s++)e.util.contains(t.nonterminals,u.right[s])&&(a+=1,o=s);if(a>1)n=e.grammar.cfgType;else{if(a===0)continue;if(o===0){if(r===null){r=!1;continue}if(r===!1)continue;r===!0&&(n=e.grammar.cfgType)}else if(o===u.right.length-1){if(r===null){r=!0;continue}if(r===!0)continue;r===!1&&(n=e.grammar.cfgType)}else n=e.grammar.cfgType}}n===e.grammar.cfgType&&(u.left.length!==1||!e.util.contains(t.nonterminals,u.left[0]))&&(n=e.grammar.csgType);if(n===e.grammar.csgType){var f=0;o=-1;for(s=0;s<u.left.length;s++)e.util.contains(t.nonterminals,u.left[s])&&(f+=1,o=s);if(f>1)return e.grammar.unrestrictedType;var l=u.left.slice(0,o-1),c=u.left.slice(o);for(s=0;s<l.length;s++)if(!e.util.areEquivalent(l[s],u.right[s]))return e.grammar.unrestrictedType;for(s=0;s<c.length;s++)if(!e.util.areEquivalent(c[c.length-s-1],u.right[u.right.length-s-1]))return e.grammar.unrestrictedType;if(u.right.length<=l.length+c.length)return e.grammar.unrestrictedType}}return n},e.grammar.printAscii=function(t){var n=[];n.push("Initial nonterminal: <"+t.initialNonterminal+">");var r=[],i,s,o;for(i=0;i<t.productions.length;i++){var u=-1;for(s=0;s<r.length;s++)if(e.util.areEquivalent(r[s][0],t.productions[i].left)){u=s;break}u===-1?r[r.length]=[t.productions[i].left,[t.productions[i].right]]:r[u][1].push(t.productions[i].right)}for(i=0;i<r.length;i++){var a=[];for(s=0;s<r[i][0].length;s++)e.util.contains(t.nonterminals,r[i][0][s])?a.push("<"+r[i][0][s].toString()+">"):r[i][0][s]===e.grammar.epsilonSymbol?a.push(r[i][0][s].toString()):a.push('"'+r[i][0][s].toString()+'"');a.push("->");for(s=0;s<r[i][1].length;s++){for(o=0;o<r[i][1][s].length;o++)e.util.contains(t.nonterminals,r[i][1][s][o])?a.push("<"+r[i][1][s][o].toString()+">"):r[i][1][s][o]===e.grammar.epsilonSymbol?a.push(r[i][1][s][o].toString()):a.push('"'+r[i][1][s][o].toString()+'"');s<r[i][1].length-1&&a.push("|")}n.push(a.join(" "))}return n.join("\n")},e.re=function(){var t=function(){function n(e,t){var n;for(n in e)e.hasOwnProperty(n)&&delete e[n];for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}function i(e,r){return e.tag===t.SEQ&&e.elements.length===1?(e.tag=e.elements[0].tag,n(e,e.elements[0]),!0):!1}function s(e,r){return e.tag===t.ALT&&e.choices.length===1?(e.tag=e.choices[0].tag,n(e,e.choices[0]),!0):!1}function o(e,n){return e.tag===t.KSTAR&&e.expr.tag===t.EPS?(e.tag=e.expr.tag,delete e.expr,!0):!1}function u(e,n){return e.tag===t.KSTAR&&e.expr.tag===t.KSTAR?(e.expr=e.expr.expr,!0):!1}function a(e,n){if(e.tag===t.KSTAR&&e.expr.tag===t.ALT){var r=!1;for(var i=0;i<e.expr.choices.length;i++)if(e.expr.choices[i].tag===t.KSTAR)return e.expr.choices[i]=e.expr.choices[i].expr,!0}return!1}function f(e,n){if(e.tag===t.ALT&&e.choices.length>=2){var r=-1,i=-1;for(var s=0;s<e.choices.length;s++)e.choices[s].tag===t.EPS?r=s:e.choices[s].tag===t.KSTAR&&(i=s);if(r>=0&&i>=0)return e.choices.splice(r,1),!0}return!1}function l(e,n){if(e.tag===t.KSTAR&&e.expr.tag===t.SEQ&&e.expr.elements.length>0){var r=!0;for(var i=0;i<e.expr.elements.length;i++)if(e.expr.elements[i].tag!==t.KSTAR){r=!1;break}if(r)return e.expr.tag=t.ALT,e.expr.choices=e.expr.elements,delete e.expr.elements,!0}return!1}function c(e,n){if(e.tag===t.SEQ&&e.elements.length>=2){var r=-1;for(var i=0;i<e.elements.length;i++)e.elements[i].tag===t.EPS&&(r=i);if(r>=0)return e.elements.splice(r,1),!0}return!1}function h(e,n){if(e.tag===t.ALT&&e.choices.length>=2){var r=-1,i;for(i=0;i<e.choices.length;i++)e.choices[i].tag===t.ALT&&(r=i);if(r>=0){var s=e.choices[r];e.choices.splice(r,1);for(i=0;i<s.choices.length;i++)e.choices.splice(r+i,0,s.choices[i]);return!0}}return!1}function p(e,n){if(e.tag===t.SEQ&&e.elements.length>=2){var r=-1,i;for(i=0;i<e.elements.length;i++)if(e.elements[i].tag===t.SEQ){r=i;break}if(r>=0){var s=e.elements[i];e.elements.splice(i,1);for(i=0;i<s.elements.length;i++)e.elements.splice(r+i,0,s.elements[i]);return!0}}return!1}function d(n,r){if(n.tag===t.ALT&&n.choices.length>=2)for(var i=0;i<n.choices.length-1;i++){var s=-1;for(var o=i+1;o<n.choices.length;o++)if(e.util.areEquivalent(n.choices[i],n.choices[o])){s=o;break}if(s>=0)return n.choices.splice(s,1),!0}return!1}function v(n,r){if(n.tag===t.ALT&&n.choices.length>=2)for(var i=0;i<n.choices.length-1;i++){var s=-1;for(var o=i+1;o<n.choices.length;o++){if(n.choices[o].tag===t.KSTAR&&e.util.areEquivalent(n.choices[o].expr,n.choices[i])){s=i;break}if(n.choices[i].tag===t.KSTAR&&e.util.areEquivalent(n.choices[i].expr,n.choices[o])){s=o;break}}if(s>=0)return n.choices.splice(s,1),!0}return!1}function m(n,r){if(n.tag===t.SEQ&&n.elements.length>=2){var i=-1;for(var s=0;s<n.elements.length-1;s++)if(n.elements[s].tag===t.KSTAR&&n.elements[s+1].tag===t.KSTAR&&e.util.areEquivalent(n.elements[s],n.elements[s+1])){i=s;break}if(i>=0)return n.elements.splice(i+1,1),!0}return!1}function g(n,r){if(n.tag===t.KSTAR&&n.expr.tag===t.ALT&&n.expr.choices.length>=2)for(var i=0;i<n.expr.choices.length;i++)for(var s=0;s<n.expr.choices.length;s++)if(i!==s&&n.expr.choices[s].tag===t.SEQ&&n.expr.choices[s].elements.length>=2){var o=!0;for(var u=0;u<n.expr.choices[s].elements.length;u++)if(!e.util.areEquivalent(n.expr.choices[i],n.expr.choices[s].elements[u])){o=!1;break}if(o)return n.expr.choices.splice(s,1),!0}return!1}function y(e,n){if(e.tag===t.KSTAR&&e.expr.tag===t.ALT&&e.expr.choices.length>=2)for(var r=0;r<e.expr.choices.length;r++)if(e.expr.choices[r].tag===t.EPS)return e.expr.choices.splice(r,1),!0;return!1}function b(n,r){if(n.tag===t.ALT&&n.choices.length>=2)for(var i=0;i<n.choices.length-1;i++)if(n.choices[i].tag===t.SEQ&&n.choices[i].elements.length>=2)for(var s=i+1;s<n.choices.length;s++)if(n.choices[s].tag===t.SEQ&&n.choices[s].elements.length>=2&&e.util.areEquivalent(n.choices[s].elements[0],n.choices[i].elements[0])){var o=n.choices[i].elements[0],u=D(n.choices[i].elements.slice(1)),a=D(n.choices[s].elements.slice(1)),f=_([u,a]),l=D([o,f]);return n.choices[i]=l,n.choices.splice(s,1),!0}return!1}function w(n,r){if(n.tag===t.SEQ&&n.elements.length>=3)for(var i=1;i<n.elements.length-1;i++)if(n.elements[i-1].tag===t.KSTAR&&n.elements[i+1].tag===t.KSTAR&&e.util.areEquivalent(n.elements[i-1],n.elements[i+1])&&e.util.areEquivalent(n.elements[i-1].expr,n.elements[i]))return n.elements.splice(i-1,1),!0;return!1}function E(n,r){if(n.tag===t.ALT&&n.choices.length>=2)for(var i=0;i<n.choices.length-1;i++)if(n.choices[i].tag===t.SEQ&&n.choices[i].elements.length>=2)for(var s=i+1;s<n.choices.length;s++)if(n.choices[s].tag===t.SEQ&&n.choices[s].elements.length>=2&&e.util.areEquivalent(n.choices[s].elements[n.choices[s].elements.length-1],n.choices[i].elements[n.choices[i].elements.length-1])){var o=n.choices[i].elements[n.choices[i].elements.length-1],u=D(n.choices[i].elements.slice(0,n.choices[i].elements.length-1)),a=D(n.choices[s].elements.slice(0,n.choices[s].elements.length-1)),f=_([u,a]),l=D([f,o]);return n.choices[i]=l,n.choices.splice(s,1),!0}return!1}function S(n,r){if(n.tag===t.ALT&&n.choices.length>=2){var i=[];i.push(T(n.choices[0],r));var s=-1;for(var o=0;o<n.choices.length-1;o++)for(var u=o+1;u<n.choices.length;u++){i.length<=u&&i.push(T(n.choices[u],r));try{e.fsm.isSubset(i[o],i[u])&&(s=u)}catch(a){}try{e.fsm.isSubset(i[u],i[o])&&(s=o)}catch(a){}if(s>=0)return n.choices.splice(s,1),!0}}return!1}function x(n,r){if(n.tag===t.KSTAR&&n.expr.tag===t.ALT&&n.expr.choices.length>=2){var i=[];i.push(T(P(n.expr.choices[0]),r));var s=-1;for(var o=0;o<n.expr.choices.length-1;o++)for(var u=o+1;u<n.expr.choices.length;u++){i.length<=u&&i.push(T(P(n.expr.choices[u]),r));try{e.fsm.isSubset(i[o],i[u])&&(s=u)}catch(a){}try{e.fsm.isSubset(i[u],i[o])&&(s=o)}catch(a){}if(s>=0)return n.expr.choices.splice(s,1),!0}}return!1}function T(t,n){var r=n.get(t);return r||(r=e.fsm.minimize(e.re.tree.toAutomaton(t)),n.put(t,r)),r}function N(n,r){if(n.tag===t.SEQ&&n.elements.length>=2){var i=[];i.push(T(n.elements[0],r));var s=-1;for(var o=0;o<n.elements.length-1;o++){i.push(T(n.elements[o+1],r));if(n.elements[o].tag===t.KSTAR&&n.elements[o+1].tag===t.KSTAR){try{e.fsm.isSubset(i[o],i[o+1])&&(s=o+1)}catch(u){}try{e.fsm.isSubset(i[o+1],i[o])&&(s=o)}catch(u){}if(s>=0)return n.elements.splice(s,1),!0}}}return!1}function C(n,r){if(n.tag===t.ALT&&n.choices.length>1){var i=e.util.index(n.choices,j());if(i>=0)for(var s=0;s<n.choices.length;s++)if(n.choices[s].tag!==t.EPS){var o=T(n.choices[s],r);if(e.fsm.isAcceptingState(o,o.initialState))return n.choices.splice(i,1),!0}}return!1}function k(n,r){if(n.tag===t.SEQ&&n.elements.length>1)for(var i=0;i<n.elements.length-1;i++)if(n.elements[i].tag===t.KSTAR&&n.elements[i+1].tag===t.ALT&&n.elements[i+1].choices.length===2){var s=e.util.index(n.elements[i+1].choices,j());if(s>=0){var o=s===0?n.elements[i+1].choices[1]:n.elements[i+1].choices[0];if(o.tag===t.SEQ&&o.elements.length===2&&o.elements[1].tag===t.KSTAR&&o.elements[1].expr.tag===t.ALT&&o.elements[1].expr.choices.length===2&&e.util.contains(o.elements[1].expr.choices,n.elements[i].expr)&&e.util.contains(o.elements[1].expr.choices,o.elements[0]))return n.elements[i+1]=o.elements[1],n.elements.splice(i,1),!0}}return!1}function L(n,r){if(n.tag===t.SEQ&&n.elements.length>1)for(var i=1;i<n.elements.length;i++)if(n.elements[i].tag===t.KSTAR&&n.elements[i-1].tag===t.ALT&&n.elements[i-1].choices.length===2){var s=e.util.index(n.elements[i-1].choices,j());if(s>=0){var o=s===0?n.elements[i-1].choices[1]:n.elements[i-1].choices[0];if(o.tag===t.SEQ&&o.elements.length===2&&o.elements[0].tag===t.KSTAR&&o.elements[0].expr.tag===t.ALT&&o.elements[0].expr.choices.length===2&&e.util.contains(o.elements[0].expr.choices,n.elements[i].expr)&&e.util.contains(o.elements[0].expr.choices,o.elements[1]))return n.elements[i-1]=o.elements[0],n.elements.splice(i,1),!0}}return!1}function A(t,n){var r=e.util.clone(t);typeof n=="undefined"&&(n={});var i=e.util.clone(n);typeof i.numIterations=="undefined"&&(i.numIterations=null),typeof i.appliedPatterns=="undefined"?i.appliedPatterns=null:i.appliedPatterns=n.appliedPatterns,typeof i.useFsmPatterns=="undefined"&&(i.useFsmPatterns=!0);var s="temp",o=0,u=new e.util.HashTable;while(s!==null&&(i.numIterations===null||o<i.numIterations))s=O(r,u,i.useFsmPatterns),s!==null&&i.appliedPatterns!==null&&i.appliedPatterns.push(s),o+=1;return r}function O(e,t,n){var i=null,s=null;for(var o=0;o<r.length;o++){i=r[o];if(n===!1&&i.type==="fsm")continue;s=M(e,i["function"],t);if(s)return i.pattern}return null}function M(e,n,r){var i=n(e,r);if(i)return i;var s=[];e.tag===t.ALT?s=e.choices:e.tag===t.SEQ?s=e.elements:e.tag===t.KSTAR&&(s=[e.expr]);for(var o=0;o<s.length;o++){i=M(s[o],n,r);if(i)return i}return!1}function _(e){return{tag:t.ALT,choices:e}}function D(e){return{tag:t.SEQ,elements:e}}function P(e){return{tag:t.KSTAR,expr:e}}function H(e){return{tag:t.LIT,obj:e}}function j(){return B}function F(t,n,r){var i=e.fsm.addState(n,r.getAndAdvance()),s=e.fsm.addState(n,r.getAndAdvance());for(var o=0;o<t.choices.length;o++){var u=W(t.choices[o],n,r);e.fsm.addEpsilonTransition(n,i,[u[0]]),e.fsm.addEpsilonTransition(n,u[1],[s])}return[i,s]}function I(t,n,r){var i,s,o;for(var u=0;u<t.elements.length;u++)o=W(t.elements[u],n,r),u===0?i=o[0]:e.fsm.addEpsilonTransition(n,s,[o[0]]),s=o[1];return i===undefined&&(i=e.fsm.addState(n,r.getAndAdvance()),s=e.fsm.addState(n,r.getAndAdvance())),[i,s]}function q(t,n,r){var i=e.fsm.addState(n,r.getAndAdvance()),s=e.fsm.addState(n,r.getAndAdvance()),o=W(t.expr,n,r),u=o[0],a=o[1];return e.fsm.addEpsilonTransition(n,i,[s]),e.fsm.addEpsilonTransition(n,i,[u]),e.fsm.addEpsilonTransition(n,a,[u]),e.fsm.addEpsilonTransition(n,a,[s]),[i,s]}function R(t,n,r){var i=e.fsm.addState(n,r.getAndAdvance()),s=e.fsm.addState(n,r.getAndAdvance());try{e.fsm.addSymbol(n,t.obj)}catch(o){}return e.fsm.addTransition(n,i,[s],t.obj),[i,s]}function U(t,n,r){var i=e.fsm.addState(n,r.getAndAdvance()),s=e.fsm.addState(n,r.getAndAdvance());return e.fsm.addEpsilonTransition(n,i,[s]),[i,s]}function W(e,t,n){return z[e.tag](e,t,n)}function X(t){var n=e.fsm.makeNew(),r=W(t,n,e.util.makeCounter(0));return e.fsm.setInitialState(n,r[0]),e.fsm.addAcceptingState(n,r[1]),n}function $(e,t){return V[e.tag]>=V[t.tag]}function J(t,n,r){var i=$(t,n);i&&r.push(e.re.array.specials.LEFT_PAREN),nt(n,r),i&&r.push(e.re.array.specials.RIGHT_PAREN)}function K(e,t,n,r){for(var i=0;i<n.length;i++)r!==undefined&&i>0&&t.push(r),J(e,n[i],t)}function Q(t,n){K(t,n,t.choices,e.re.array.specials.ALT)}function G(e,t){K(e,t,e.elements)}function Y(t,n){J(t,t.expr,n),n.push(e.re.array.specials.KSTAR)}function Z(e,t){t.push(e.obj)}function et(t,n){n.push(e.re.array.specials.EPS)}function nt(e,t){return tt[e.tag](e,t)}function rt(e){var t=[];return nt(e,t),t}function it(t){return e.re.array.toString(rt(t))}function st(e,t,n){var r=.5,i=.1,s=.1;return n&&(n.ALT_PROB&&(r=n.ALT_PROB),n.KLEENE_PROB&&(i=n.KLEENE_PROB),n.EPS_PROB&&(s=n.EPS_PROB)),ot(e,t,r,i,s)}function ot(e,t,n,r,i){var s=ut(e,t,n,r,i);return Math.random()<=r&&(s=P(s)),s}function ut(t,n,r,i,s){if(t===0)return j();if(t==1)return H(n[e.util.randint(0,n.length-1)]);if(Math.random()<=s)return _([j(),ot(t,n,r,i,s)]);var o=e.util.randint(1,t-1),u=ot(o,n,r,i,s),a=ot(t-o,n,r,i,s);return Math.random()<=r?_([u,a]):D([u,a])}var t={ALT:"alt",SEQ:"sequence",KSTAR:"kleene_star",LIT:"literal",EPS:"epsilon"},r=[];r.push({pattern:"(a) => a",type:"structure","function":i}),r.push({pattern:"(a) => a",type:"structure","function":s}),r.push({pattern:"$* => $",type:"structure","function":o}),r.push({pattern:"(a*)* => a*",type:"structure","function":u}),r.push({pattern:"(a+b*)* => (a+b)*",type:"structure","function":a}),r.push({pattern:"$+a* => a*",type:"structure","function":f}),r.push({pattern:"(a*b*)* => (a*+b*)*",type:"structure","function":l}),r.push({pattern:"$a => a",type:"structure","function":c}),r.push({pattern:"a+a => a",type:"structure","function":d}),r.push({pattern:"a+a* => a*",type:"structure","function":v}),r.push({pattern:"a*a* => a*",type:"structure","function":m}),r.push({pattern:"(aa+a)* => (a)*",type:"structure","function":g}),r.push({pattern:"(a + $)* => (a)*",type:"structure","function":y}),r.push({pattern:"(ab+ac) => a(b+c)",type:"structure","function":b}),r.push({pattern:"a*aa* => aa*",type:"structure","function":w}),r.push({pattern:"(ab+cb) => (a+c)b",type:"structure","function":E}),r.push({pattern:"a*($+b(a+b)*) => (a+b)*",type:"structure","function":k}),r.push({pattern:"($+(a+b)*a)b* => (a+b)*",type:"structure","function":L}),r.push({pattern:"$+L => L, if L contains $",type:"fsm","function":C}),r.push({pattern:"L1+L2 => L2, if L1 is subset of L2",type:"fsm","function":S}),r.push({pattern:"(L1+L2)* => L2, if L1* is subset of L2*",type:"fsm","function":x}),r.push({pattern:"L1*L2* => L2, if L1* is subset of L2*",type:"fsm","function":N}),r.push({pattern:"ab(cd) => abcd",type:"structure","function":p}),r.push({pattern:"(a+(b+c)) => a+b+c",type:"structure","function":h});var B={tag:t.EPS},z={};z[t.ALT]=F,z[t.SEQ]=I,z[t.KSTAR]=q,z[t.LIT]=R,z[t.EPS]=U;var V={};V[t.ALT]=0,V[t.SEQ]=1,V[t.KSTAR]=2,V[t.LIT]=3,V[t.EPS]=3;var tt={};return tt[t.ALT]=Q,tt[t.SEQ]=G,tt[t.KSTAR]=Y,tt[t.LIT]=Z,tt[t.EPS]=et,{tags:t,makeAlt:_,makeSeq:D,makeKStar:P,makeLit:H,makeEps:j,toAutomaton:X,toArray:rt,toString:it,random:st,simplify:A}}(),n=function(){function n(){return this.arr[this.idx]}function r(){++this.idx}function i(e){return{arr:e,idx:0,peek:n,advance:r}}function s(e){var t=i(e),n=l(t);if(t.peek()!==undefined)throw new Error("Malformed regex array: successfully parsed up to position "+t.idx);return n}function o(e){return e===t.ALT||e===t.KSTAR||e===t.LEFT_PAREN||e===t.RIGHT_PAREN||e===t.EPS?e.toString():undefined}function u(t){var n=e.re.string.escapable;for(var r=0;r<n.length;r++)if(t===n[r])return"\\"+t;return t}function a(e){var t=[],n,r=!1;for(var i=0;i<e.length;i++){n=e[i],typeof n=="string"?n.length!==1?r=!0:n=u(n):(n=o(n),n===undefined&&(r=!0));if(r)throw new Error("Array regex not convertible to string representation: failed at position "+i);t.push(n)}return t.join("")}function f(t){var n=e.re.array.toTree(t);return e.re.tree.toAutomaton(n)}function l(n){var r=[];for(;;){r.push(c(n));if(n.peek()!==t.ALT)break;n.advance()}return e.re.tree.makeAlt(r)}function c(t){var n=[],r;for(;;){r=h(t);if(r===undefined)break;n.push(r)}return e.re.tree.makeSeq(n)}function h(n){var r=p(n);return n.peek()===t.KSTAR&&(n.advance(),r=e.re.tree.makeKStar(r)),r}function p(n){if(n.peek()===t.LEFT_PAREN){n.advance();var r=l(n);if(n.peek()!==t.RIGHT_PAREN)throw new Error("Malformed regex array: missing matching right parenthesis at index "+n.idx);return n.advance(),r}if(n.peek()===t.EPS)return n.advance(),e.re.tree.makeEps();if(n.peek()===undefined||n.peek()===t.ALT||n.peek()===t.RIGHT_PAREN)return undefined;var i=e.re.tree.makeLit(n.peek());return n.advance(),i}function d(t,n,r){return e.re.tree.toArray(e.re.tree.random(t,n,r))}function v(t,n,r){var i=e.re.array.toTree(t),s=e.re.tree.simplify(i,n,r);return e.re.tree.toArray(s)}var t={ALT:{},KSTAR:{},LEFT_PAREN:{},RIGHT_PAREN:{},EPS:{}};return t.ALT.toString=function(){return"+"},t.KSTAR.toString=function(){return"*"},t.LEFT_PAREN.toString=function(){return"("},t.RIGHT_PAREN.toString=function(){return")"},t.EPS.toString=function(){return"$"},{specials:t,toTree:s,toString:a,toAutomaton:f,random:d,simplify:v}}(),r=function(){function n(n){var r=[],i=!1,s=e.re.array.specials,o;for(var u=0;u<n.length;++u)if(i){if(t.indexOf(n[u])===-1)throw new Error("Malformed string regex: illegal escape sequence \\"+n[u]);r.push(n[u]),i=!1}else if(n[u]==="\\")i=!0;else{o=n[u];switch(o){case"$":o=s.EPS;break;case"+":o=s.ALT;break;case"*":o=s.KSTAR;break;case"(":o=s.LEFT_PAREN;break;case")":o=s.RIGHT_PAREN}r.push(o)}if(i)throw new Error("Malformed string regex: unfinished escape sequence at end of string");return r}function r(t){var n=e.re.string.toArray(t);return e.re.array.toTree(n)}function i(t){var n=e.re.string.toTree(t);return e.re.tree.toAutomaton(n)}function s(t,n,r){var i=[];for(var s=0;s<n.length;s++)i.push(n.charAt(s));return e.re.tree.toString(e.re.tree.random(t,i,r))}function o(t,n,r){var i=e.re.string.toTree(t),s=e.re.tree.simplify(i,n,r);return e.re.tree.toString(s)}var t="$+*()\\";return{escapable:t,toArray:n,toTree:r,toAutomaton:i,random:s,simplify:o}}();return{tree:t,array:n,string:r}}(),e}());