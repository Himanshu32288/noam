(function(t){"undefined"!=typeof module&&module.exports!==void 0&&(module.exports=t),"undefined"!=typeof exports&&"function"!=typeof exports&&(exports.noam=t),"function"==typeof define&&define.amd&&define("noam",[],function(){return t}),"undefined"!=typeof window&&(window.noam=t)})(function(){var t={};t.util={},t.util.areEquivalent=function(e,n){if(e===n)return!0;if(e instanceof Date&&n instanceof Date)return e.getTime()===n.getTime();if(e instanceof RegExp&&n instanceof RegExp)return e.source===n.source&&e.global===n.global&&e.multiline===n.multiline&&e.lastIndex===n.lastIndex&&e.ignoreCase===n.ignoreCase;if(!(e instanceof Object&&n instanceof Object))return!1;if(e===void 0||n===void 0)return!1;if(e.constructor!==n.constructor)return!1;for(var a in e){if(!(a in n))return!1;if(e[a]!==n[a]){if("object"!=typeof e[a])return!1;if(!t.util.areEquivalent(e[a],n[a]))return!1}}for(a in n)if(!(a in e))return!1;return!0},t.util.contains=function(e,n,a){a=a?a:0;for(var r=a;e.length>r;r++)if(t.util.areEquivalent(e[r],n))return!0;return!1},t.util.index=function(e,n,a){for(var r=a||0;e.length>r;){if(t.util.areEquivalent(e[r],n))return r;r++}return-1},t.util.containsAll=function(e,n){for(var a=0;n.length>a;a++)if(!t.util.contains(e,n[a]))return!1;return!0},t.util.containsAny=function(e,n){for(var a=0;n.length>a;a++)if(t.util.contains(e,n[a]))return!0;return!1},t.util.areEqualSets=function(e,n){if(e.length!==n.length)return!1;for(var a=0;e.length>a;a++)if(!t.util.contains(n,e[a]))return!1;return!0},t.util.containsSet=function(e,n){for(var a=0;e.length>a;a++)if(t.util.areEqualSets(e[a],n))return!0;return!1},t.util.setUnion=function(e,n){var a,r=[];for(a=0;e.length>a;a++)t.util.contains(r,e[a])||r.push(e[a]);for(a=0;n.length>a;a++)t.util.contains(r,n[a])||r.push(n[a]);return r},t.util.setIntersection=function(e,n){var a,r=[];for(a=0;e.length>a;a++)t.util.contains(n,e[a])&&r.push(e[a]);return r},t.util.clone=function(t){return JSON.parse(JSON.stringify(t))},t.util.makeCounter=function(){function t(){return this.value++}function e(e){return{value:e,getAndAdvance:t}}return e}(),t.util.randint=function(t,e){return Math.floor(Math.random()*(e-t+1))+t};var e={};return function(){function t(t){return"[object Array]"===Object.prototype.toString.call(t)}function n(t){t=Math.max(t,p[0]),t=Math.min(t,p[p.length-1]);for(var e,n=0,a=p.length-1;a>n;)e=n+Math.floor((a-n)/2),p[e]>=t?a=e:n=e+1;return n}function a(e){var n,r;if(void 0===e)return 12345;if(null===e)return 54321;if("boolean"==typeof e||"number"==typeof e)return e&g;if("string"==typeof e){for(n=5381,r=0;e.length>r;r++)n=(33*n^e.charCodeAt(r))&g;return n}if(t(e)){for(n=6421,r=0;e.length>r;r++)n=(37*n^a(e[r]))&g;return n}var i=[];for(r in e)e.hasOwnProperty(r)&&i.push(r);for(i.sort(),n=3203,r=0;i.length>r;r++)n=(43*(39*n^a(i[r]))^a(e[i[r]]))&g;return n}function r(t,e){if(t===e)return!0;if(t instanceof Date&&e instanceof Date)return t.getTime()===e.getTime();if(t instanceof RegExp&&e instanceof RegExp)return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase;if(!(t instanceof Object&&e instanceof Object))return!1;if(t===void 0||e===void 0)return!1;if(t.constructor!==e.constructor)return!1;for(var n in t){if(!(n in e))return!1;if(t[n]!==e[n]){if("object"!=typeof t[n])return!1;if(!r(t[n],e[n]))return!1}}for(n in e)if(!(n in t))return!1;return!0}function i(t,e){this.key=t,this.value=e}function s(){}function o(t){this.node=t.head}function l(t,e){if(e>=p.length)throw Error("Capacity of HashTable can't grow beyond "+p[p.length-1]);if(e>=0){var n=t.capacity,a=t.slots;t.capacity_index=e,t.capacity=p[e],t.slots=[];for(var r=0;n>r;r++)if(void 0!==a[r])for(var i=a[r].iterator();i.hasNext();)t._putNodeRsz(i.next())}}function u(t,e){return t.hash(e)%t.capacity}function c(t){this.idx=0,this.H=t}function f(t){this.idx=0,this.H=t}function h(t){this.idx=0,this.H=t}var p=[5,11,23,47,97,197,397,797,1597,3203,6421,12853,25717,51437,102877,205759,411527,823117,1646237,3292489,6584983,13169977,26339969,52679969,105359939],m=0,g=(1<<31)-1,S=.75,v=.25;s.prototype.isEmpty=function(){return void 0===this.head},s.prototype.insertHead=function(t){t.next=this.head,this.head=t},s.prototype.removeSuccessor=function(t){void 0===t?this.head=this.head.next:t.next=t.next.next},s.prototype.put=function(t,e,n){for(var a=this.iterator();a.hasNext();){var r=a.next();if(t.equals(e,r.key))return r.value=n,!1}return this.insertHead(new i(e,n)),!0},s.prototype.get=function(t,e){for(var n=this.iterator();n.hasNext();){var a=n.next();if(t.equals(e,a.key))return a.value}return void 0},s.prototype.remove=function(t,e){for(var n,a=this.iterator();a.hasNext();){var r=a.next();if(t.equals(e,r.key))return this.removeSuccessor(n),!0;n=r}return!1},o.prototype.hasNext=function(){return void 0!==this.node},o.prototype.next=function(){if(!this.hasNext())throw Error("HashTable internal error: called _HashChainIterator.next on exhausted iterator");var t=this.node;return this.node=t.next,t},s.prototype.iterator=function(){return new o(this)},e.HashTable=function(t){this.capacity_index=m,t&&(t.initial_capacity&&(this.capacity_index=n(t.initial_capacity)),t.hash&&(this.hash=t.hash),t.equals&&(this.equals=t.equals)),this.capacity=p[this.capacity_index],this.numkeys=0,this.slots=[]},e.HashTable.prototype.hash=a,e.HashTable.prototype.equals=r,e.HashTable.prototype.loadFactor=function(){return this.numkeys/this.capacity},e.HashTable.prototype.put=function(t,e){if(void 0===t)throw Error("called HashTable.put with key === undefined");if(void 0===e)throw Error("called HashTable.put with value === undefined");var n=u(this,t);void 0===this.slots[n]&&(this.slots[n]=new s),this.slots[n].put(this,t,e)&&(++this.numkeys,this.loadFactor()>S&&l(this,this.capacity_index+1))},e.HashTable.prototype._putNodeRsz=function(t){var e=u(this,t.key);void 0===this.slots[e]&&(this.slots[e]=new s),this.slots[e].insertHead(t)},e.HashTable.prototype.get=function(t){if(void 0===t)throw Error("called HashTable.get with key === undefined");var e=u(this,t),n=this.slots[e];return void 0===n?void 0:n.get(this,t)},e.HashTable.prototype.remove=function(t){if(void 0===t)throw Error("called HashTable.remove with key === undefined");var e=u(this,t),n=this.slots[e];void 0!==n&&n.remove(this,t)&&(--this.numkeys,v>this.loadFactor()&&l(this,this.capacity_index-1))},e.HashTable.prototype.isEmpty=function(){return 0===this.numkeys},e.HashTable.prototype.clear=function(){this.capacity_index=m,this.capacity=p[this.capacity_index],this.numkeys=0,this.slots=[]},e.HashTable.prototype.size=function(){return this.numkeys},e.HashTable.prototype.containsKey=function(t){if(void 0===t)throw Error("called HashTable.containsKey with key === undefined");return void 0!==this.get(t)},e.HashTable.prototype.keys=function(){for(var t=[],e=this.keyIterator();e.hasNext();)t.push(e.next());return t},e.HashTable.prototype.values=function(){for(var t=[],e=this.valueIterator();e.hasNext();)t.push(e.next());return t},e.HashTable.prototype.entries=function(){for(var t=[],e=this.keyValueIterator();e.hasNext();)t.push(e.next());return t};var d={hasNext:function(){if(void 0!==this.cur_chain_iterator&&this.cur_chain_iterator.hasNext())return!0;for(void 0!==this.cur_chain_iterator&&++this.idx;this.idx<this.H.capacity&&(void 0===this.H.slots[this.idx]||this.H.slots[this.idx].isEmpty());)++this.idx;var t=this.H.slots[this.idx];return void 0===t?(this.cur_chain_iterator=void 0,!1):(this.cur_chain_iterator=t.iterator(),!0)},_next:function(t,e){if(!this.hasNext())throw Error(t);var n=e(this);return n},each:function(t,e){if(void 0===t)throw Error("called iterator.each with iterator_func === undefined");for(var n=0;this.hasNext();n++)t.call(e,this.next(),n,this.H)}};c.prototype=Object.create(d),c.prototype.next=function(){return this._next("KeyIterator.next called on empty iterator",function(t){return t.cur_chain_iterator.next().key})},f.prototype=Object.create(d),f.prototype.next=function(){return this._next("ValueIterator.next called on empty iterator",function(t){return t.cur_chain_iterator.next().value})},h.prototype=Object.create(d),h.prototype.next=function(){return this._next("KeyValueIterator.next called on empty iterator",function(t){var e=t.cur_chain_iterator.next();return[e.key,e.value]})},e.HashTable.prototype.keyIterator=function(){return new c(this)},e.HashTable.prototype.valueIterator=function(){return new f(this)},e.HashTable.prototype.keyValueIterator=function(){return new h(this)}}(),t.util.HashTable=e.HashTable,delete e,t.fsm={},t.fsm.epsilonSymbol="$",t.fsm.dfaType="DFA",t.fsm.nfaType="NFA",t.fsm.enfaType="eNFA",t.fsm.makeNew=function(){return{states:[],alphabet:[],acceptingStates:[],initialState:void 0,transitions:[]}},t.fsm._addStateOrSymbol=function(e,n,a,r){if(void 0===n)throw Error(a);if(t.util.contains(e,n))throw Error(r);return e.push(n),n},t.fsm.addState=function(e,n){return t.fsm._addStateOrSymbol(e.states,n,"No state object specified","State already exists")},t.fsm.addSymbol=function(e,n){if(t.util.areEquivalent(n,t.fsm.epsilonSymbol))throw Error("Can't add the epsilon symbol to the alphabet");return t.fsm._addStateOrSymbol(e.alphabet,n,"No symbol object specified","Symbol already exists")},t.fsm.addAcceptingState=function(e,n){if(!t.util.contains(e.states,n))throw Error("The specified object is not a state of the FSM");t.fsm._addStateOrSymbol(e.acceptingStates,n,"","The specified state is already accepting")},t.fsm.setInitialState=function(e,n){if(!t.util.contains(e.states,n))throw Error("The specified object is not a state of the FSM");e.initialState=n},t.fsm._addTransition=function(e,n,a,r){if(!Array.isArray(a))throw Error("The toStates argument must be an array");if(!t.util.contains(e.states,n)||!t.util.containsAll(e.states,a))throw Error("One of the specified objects is not a state of the FSM");var i,s=!1;for(i=0;e.transitions.length>i;i++)if(t.util.areEquivalent(n,e.transitions[i].fromState)&&t.util.areEquivalent(r,e.transitions[i].transitionSymbol)){e.transitions[i].toStates=t.util.setUnion(e.transitions[i].toStates,a),s=!0;break}s||e.transitions.push({fromState:n,toStates:a,symbol:r})},t.fsm.addTransition=function(e,n,a,r){if(!t.util.contains(e.alphabet,r))throw Error("The specified object is not an alphabet symbol of the FSM");t.fsm._addTransition(e,n,a,r)},t.fsm.addEpsilonTransition=function(e,n,a){t.fsm._addTransition(e,n,a,t.fsm.epsilonSymbol)},t.fsm.validate=function(e){var n,a,r;if(!(e!==void 0&&Array.isArray(e.states)&&Array.isArray(e.alphabet)&&Array.isArray(e.acceptingStates)&&e.initialState!==void 0&&null!==e.initialState&&Array.isArray(e.transitions)))throw Error("FSM must be defined and have states, alphabet, acceptingStates, initialState and transitions array properties!");if(1>e.states.length)throw Error("Set of states must not be empty.");for(n=0;e.states.length>n;n++)if(t.util.contains(e.states,e.states[n],n+1))throw Error("Equivalent states");if(1>e.alphabet.length)throw Error("Alphabet must not be empty.");for(n=0;e.alphabet.length>n;n++)if(t.util.contains(e.alphabet,e.alphabet[n],n+1))throw Error("Equivalent alphabet symbols");if(t.util.contains(e.alphabet,t.fsm.epsilonSymbol))throw Error("FSM alphabet must not contain the epsilon symbol");for(n=0;e.alphabet.length>n;n++)if(t.util.contains(e.states,e.alphabet[n]))throw Error("States and alphabet symbols must not overlap");for(n=0;e.acceptingStates.length>n;n++){if(t.util.contains(e.acceptingStates,e.acceptingStates[n],n+1))throw Error("Equivalent acceptingStates");if(!t.util.contains(e.states,e.acceptingStates[n]))throw Error("Each accepting state must be in states")}if(!t.util.contains(e.states,e.initialState))throw Error("Initial state must be in states");for(n=0;e.transitions.length>n;n++){var i=e.transitions[n];if(i.fromState===void 0||i.toStates===void 0||i.symbol===void 0)throw Error("Transitions must have fromState, toState and symbol");if(!t.util.contains(e.states,i.fromState))throw Error("Transition fromState must be in states.");if(!t.util.contains(e.alphabet,i.symbol)&&i.symbol!==t.fsm.epsilonSymbol)throw Error("Transition symbol must be in alphabet.");for(r=0;i.toStates.length>r;r++){if(!t.util.contains(e.states,i.toStates[r]))throw Error("Transition toStates must be in states.");if(t.util.contains(i.toStates,i.toStates[r],r+1))throw Error("Transition toStates must not contain duplicates.")}}for(n=0;e.transitions.length>n;n++)for(a=n+1;e.transitions.length>a;a++)if(e.transitions[n].fromState===e.transitions[a].fromState&&e.transitions[n].symbol===e.transitions[a].symbol)throw Error("Transitions for the same fromState and symbol must be defined in a single trainsition.");return!0},t.fsm.isAcceptingState=function(e,n){return t.util.contains(e.acceptingStates,n)},t.fsm.determineType=function(e){for(var n=t.fsm.dfaType,a=0;e.transitions.length>a;a++){var r=e.transitions[a];if(0===r.toStates.length||r.toStates.length>1)n=t.fsm.nfaType;else if(r.symbol===t.fsm.epsilonSymbol){n=t.fsm.enfaType;break}}return n===t.fsm.dfaType&&e.transitions.length<e.states.length*e.alphabet.length&&(n=t.fsm.nfaType),n},t.fsm.computeEpsilonClosure=function(e,n){if(!t.util.containsAll(e.states,n))throw Error("FSM must contain all states for which epsilon closure is being computed");for(var a=n,r=[];0!==a.length;){var i=a.pop();r.push(i);for(var s=0;e.transitions.length>s;s++){var o=e.transitions[s];if(o.symbol===t.fsm.epsilonSymbol&&t.util.areEquivalent(o.fromState,i))for(var l=0;o.toStates.length>l;l++)t.util.contains(r,o.toStates[l])||t.util.contains(a,o.toStates[l])||a.push(o.toStates[l])}}return r},t.fsm.makeSimpleTransition=function(e,n,a){if(!t.util.containsAll(e.states,n))throw Error("FSM must contain all states for which the transition is being computed");if(!t.util.contains(e.alphabet,a))throw Error("FSM must contain input symbol for which the transition is being computed");for(var r=[],i=0;e.transitions.length>i;i++){var s=e.transitions[i];if(t.util.areEquivalent(e.transitions[i].symbol,a)&&t.util.contains(n,s.fromState))for(var o=0;s.toStates.length>o;o++)t.util.contains(r,s.toStates[o])||r.push(s.toStates[o])}return r},t.fsm.makeTransition=function(e,n,a){if(!t.util.containsAll(e.states,n))throw Error("FSM must contain all states for which the transition is being computed");if(!t.util.contains(e.alphabet,a))throw Error("FSM must contain input symbol for which the transition is being computed");var r=t.util.clone(n);return r=t.fsm.computeEpsilonClosure(e,r),r=t.fsm.makeSimpleTransition(e,r,a),r=t.fsm.computeEpsilonClosure(e,r)},t.fsm.readString=function(e,n){if(!t.util.containsAll(e.alphabet,n))throw Error("FSM must contain all symbols for which the transition is being computed");for(var a=t.fsm.computeEpsilonClosure(e,[e.initialState]),r=0;n.length>r;r++)a=t.fsm.makeTransition(e,a,n[r]);return a},t.fsm.transitionTrail=function(e,n,a){if(!t.util.containsAll(e.alphabet,a))throw Error("FSM must contain all symbols for which the transition is being computed");for(var r=[n],i=[t.util.clone(r)],s=0;a.length>s;s++)r=t.fsm.makeTransition(e,r,a[s]),i.push(t.util.clone(r));return i},t.fsm.isStringInLanguage=function(e,n){var a=t.fsm.readString(e,n);return t.util.containsAny(e.acceptingStates,a)},t.fsm.printTable=function(e){var n=require("cli-table"),a=[""].concat(e.alphabet);t.fsm.determineType(e)===t.fsm.enfaType&&a.push(t.fsm.epsilonSymbol),a.push("");var r,i,s=new n({head:a,chars:{top:"-","top-mid":"+","top-left":"+","top-right":"+",bottom:"-","bottom-mid":"+","bottom-left":"+","bottom-right":"+",left:"|","left-mid":"+",mid:"-","mid-mid":"+",right:"|","right-mid":"+"},truncate:"~"}),o=[];for(r=0;e.states.length>r;r++){for(o.push(Array(a.length)),i=0;a.length>i;i++)o[r][i]="";o[r][0]=""+e.states[r],o[r][a.length-1]=t.util.contains(e.acceptingStates,e.states[r])?"1":"0",s.push(o[r])}for(r=0;e.transitions.length>r;r++){var l=e.transitions[r],u=null,c=null;for(i=0;e.states.length>i;i++)if(t.util.areEquivalent(e.states[i],l.fromState)){c=i;break}if(l.symbol===t.fsm.epsilonSymbol)u=a.length-2;else for(i=0;e.alphabet.length>i;i++)if(t.util.areEquivalent(e.alphabet[i],l.symbol)){u=i+1;break}o[c][u].text===void 0&&(o[c][u]={text:[]}),o[c][u].text.push(l.toStates)}return""+s},t.fsm.printHtmlTable=function(e){var n=[""].concat(e.alphabet);t.fsm.determineType(e)===t.fsm.enfaType&&n.push(t.fsm.epsilonSymbol),n.push("");var a,r,i=[];for(a=0;e.states.length>a;a++){for(i.push(Array(n.length)),r=0;n.length>r;r++)i[a][r]={text:[]};i[a][0]={text:""+e.states[a]},i[a][n.length-1]=t.util.contains(e.acceptingStates,e.states[a])?{text:["1"]}:{text:["0"]}}for(a=0;e.transitions.length>a;a++){var s=e.transitions[a],o=null,l=null;for(r=0;e.states.length>r;r++)if(t.util.areEquivalent(e.states[r],s.fromState)){l=r;break}if(s.symbol===t.fsm.epsilonSymbol)o=n.length-2;else for(r=0;e.alphabet.length>r;r++)if(t.util.areEquivalent(e.alphabet[r],s.symbol)){o=r+1;break}i[l][o].text===void 0&&(i[l][o]={text:[]}),i[l][o].text.push(s.toStates)}var u=[];for(u.push("<table border='1'>"),u.push("  <tr>"),a=0;n.length>a;a++)u.push("    <th>"+(""+n[a])+"</th>");for(u.push("  </tr>"),a=0;i.length>a;a++){for(u.push("  <tr>"),r=0;i[a].length>r;r++)u.push("    <td>"+i[a][r].text+"</td>");u.push("  </tr>")}return u.push("</table>"),u.join("\n")},t.fsm.printDotFormat=function(e){var n,a,r,i,s=["digraph finite_state_machine {","  rankdir=LR;"],o=["  node [shape = doublecircle];"];for(n=0;e.acceptingStates.length>n;n++)o.push(""+e.acceptingStates[n]);o.push(";"),s.push(o.join(" ")),s.push("  node [shape = circle];"),s.push("  secret_node [style=invis, shape=point];");var l=["  secret_node ->"];l.push(""+e.initialState),l.push("[style=bold];"),s.push(l.join(" "));var u=[];for(n=0;e.transitions.length>n;n++)for(a=0;e.transitions[n].toStates.length>a;a++){var c=null;for(r=0;u.length>r;r++)t.util.areEquivalent(u[r].fromState,e.transitions[n].fromState)&&t.util.areEquivalent(u[r].toStates,[e.transitions[n].toStates[a]])&&(c=u[r]);if(null===c){var f=t.util.clone(e.transitions[n]);f.symbol=[f.symbol],u.push(f)}else c.symbol.push(e.transitions[n].symbol)}for(n=0;u.length>n;n++)t.util.areEquivalent(u[n].toStates[0],e.initialState)?(i=[" "],i.push(""+u[n].toStates[0]),i.push("->"),i.push(""+u[n].fromState),i.push("["),i.push("label ="),i.push('"'+(""+u[n].symbol)+'"'),i.push(" dir = back];"),s.push(i.join(" "))):(i=[" "],i.push(""+u[n].fromState),i.push("->"),i.push(""+u[n].toStates[0]),i.push("["),i.push("label ="),i.push('"'+(""+u[n].symbol)+'"'),i.push(" ];"),s.push(i.join(" ")));return s.push("}"),s.join("\n").replace(/\$/g,"$")},t.fsm.getReachableStates=function(e,n,a){for(var r,i,s=[n],o=a?[n]:[];0!==s.length;){var l=s.pop();for(r=0;e.transitions.length>r;r++){var u=e.transitions[r];if(t.util.areEquivalent(l,u.fromState))for(i=0;u.toStates.length>i;i++)t.util.contains(o,u.toStates[i])||(o.push(u.toStates[i]),t.util.contains(s,u.toStates[i])||s.push(u.toStates[i]))}}return o},t.fsm.removeUnreachableStates=function(e){var n,a=t.fsm.getReachableStates(e,e.initialState,!0),r=t.util.clone(e);for(r.states=[],r.acceptingStates=[],r.transitions=[],n=0;e.states.length>n;n++)t.util.contains(a,e.states[n])&&r.states.push(t.util.clone(e.states[n]));for(n=0;e.acceptingStates.length>n;n++)t.util.contains(a,e.acceptingStates[n])&&r.acceptingStates.push(t.util.clone(e.acceptingStates[n]));for(n=0;e.transitions.length>n;n++)t.util.contains(a,e.transitions[n].fromState)&&r.transitions.push(t.util.clone(e.transitions[n]));return r},t.fsm.areEquivalentStates=function(e,n,a,r){function i(e,n,a,r){var i=t.util.contains(e.acceptingStates,n),s=t.util.contains(a.acceptingStates,r);return i&&s||!i&&!s}if(t.fsm.determineType(e)!==t.fsm.dfaType||t.fsm.determineType(a)!==t.fsm.dfaType)throw Error("FSMs must be DFAs");if(e.alphabet.length!==a.alphabet.length||!t.util.containsAll(e.alphabet,a.alphabet))throw Error("FSM alphabets must be the same");if(!t.util.contains(e.states,n)||!t.util.contains(a.states,r))throw Error("FSMs must contain states");for(var s,o,l=[[n,r]],u=[];0!==l.length;){var c=l.pop();if(!i(e,c[0],a,c[1]))return!1;for(u.push(c),s=0;e.alphabet.length>s;s++)for(o=0;e.alphabet.length>o;o++){var f=[t.fsm.makeTransition(e,[c[0]],e.alphabet[o])[0],t.fsm.makeTransition(a,[c[1]],e.alphabet[o])[0]];t.util.contains(u,f)||t.util.contains(l,f)||l.push(f)}}return!0},t.fsm.areEquivalentFSMs=function(e,n){return t.fsm.areEquivalentStates(e,e.initialState,n,n.initialState)},t.fsm.removeEquivalentStates=function(e){function n(e){for(var n=0;o.length>n;n++)if(t.util.areEquivalent(o[n][1],e))return!0;return!1}function a(e){for(var n=0;o.length>n;n++)if(t.util.areEquivalent(o[n][1],e))return o[n][0];return e}if(t.fsm.determineType(e)!==t.fsm.dfaType)throw Error("FSM must be DFA");var r,i,s,o=[];for(r=0;e.states.length>r;r++)for(i=r+1;e.states.length>i;i++)if(t.fsm.areEquivalentStates(e,e.states[r],e,e.states[i])){var l=[e.states[r],e.states[i]];for(s=0;o.length>s;s++)if(t.util.areEquivalent(o[s][1],l[0])){l[0]=o[s][1];break}t.util.contains(o,l)||o.push(l)}var u={states:[],alphabet:t.util.clone(e.alphabet),initialState:[],acceptingStates:[],transitions:[]};for(r=0;e.states.length>r;r++)n(e.states[r])||u.states.push(t.util.clone(e.states[r]));for(r=0;e.acceptingStates.length>r;r++)n(e.acceptingStates[r])||u.acceptingStates.push(t.util.clone(e.acceptingStates[r]));for(u.initialState=t.util.clone(a(e.initialState)),r=0;e.transitions.length>r;r++){var c=t.util.clone(e.transitions[r]);if(!n(c.fromState)){for(i=0;c.toStates.length>i;i++)c.toStates[i]=a(c.toStates[i]);u.transitions.push(c)}}return u},t.fsm.minimize=function(e){var n=t.fsm.determineType(e),a=e;n===t.fsm.nfaType?a=t.fsm.convertNfaToDfa(e):n===t.fsm.enfaType&&(a=t.fsm.convertEnfaToNfa(e),a=t.fsm.convertNfaToDfa(a));var r=t.fsm.removeUnreachableStates(a),i=t.fsm.removeEquivalentStates(r);return i},t.fsm.createRandomFsm=function(e,n,a,r){function i(t,e,n){for(var a=n,r=0;n.length-e>r;r++)a=t+n;return a}var s,o,l,u={};for(u.states=[],s=0,len=(""+n).length;n>s;s++)u.states.push("s"+i("0",len,""+s));for(u.alphabet=[],s=0,len=(""+a).length;a>s;s++)u.alphabet.push("a"+i("0",len,""+s));for(u.initialState=u.states[0],u.acceptingStates=[],s=0;n>s;s++)Math.round(Math.random())&&u.acceptingStates.push(u.states[s]);for(e===t.fsm.enfaType&&u.alphabet.push(t.fsm.epsilonSymbol),u.transitions=[],s=0;n>s;s++)for(o=0;u.alphabet.length>o;o++){var c=1;if(e!==t.fsm.dfaType&&(c=Math.floor(Math.random()*r)),c>0){var f=[];for(l=0;u.states.length>l&&c>f.length;l++){var h=u.states.length-l-(c-f.length)+1;h=0>=h?1:1/h,h>=Math.random()&&f.push(u.states[l])}u.transitions.push({fromState:u.states[s],symbol:u.alphabet[o],toStates:f})}}return e===t.fsm.enfaType&&u.alphabet.pop(),u},t.fsm.convertNfaToDfa=function(e){var n=t.fsm.determineType(e);if(n===t.fsm.enfaType)throw Error("FSM must be an NFA");if(n===t.fsm.dfaType)return e;var a,r,i,s,o={};for(o.alphabet=t.util.clone(e.alphabet),o.states=[],o.acceptingStates=[],o.initialState=[t.util.clone(e.initialState)],o.transitions=[],a=0;e.states.length>a;a++)o.states.push([t.util.clone(e.states[a])]);for(a=0;e.acceptingStates.length>a;a++)o.acceptingStates.push([t.util.clone(e.acceptingStates[a])]);var l=[];for(a=0;e.transitions.length>a;a++)s=t.util.clone(e.transitions[a]),s.fromState=[s.fromState],s.toStates=[s.toStates],s.toStates[0].length>1&&(t.util.containsSet(l,s.toStates[0])||l.push(s.toStates[0])),o.transitions.push(s);for(;0!==l.length;){var u=l.pop();for(o.states.push(u),t.util.containsAny(e.acceptingStates,u)&&o.acceptingStates.push(u),a=0;o.alphabet.length>a;a++){var c=t.fsm.makeTransition(e,u,o.alphabet[a]).sort();for(r=0;o.states.length>r;r++)if(t.util.areEqualSets(c,o.states[r])){c=o.states[r];break}for(r=0;l.length>r;r++)if(t.util.areEqualSets(c,l[r])){c=l[r];break}c.length>0&&o.transitions.push({fromState:u,symbol:o.alphabet[a],toStates:[c]}),!t.util.containsSet(o.states,c)&&!t.util.containsSet(l,c)&&c.length>1&&l.push(c)}}var f=!1,h="ERROR";for(a=0;o.states.length>a;a++)for(r=0;o.alphabet.length>r;r++){var p=!1;for(i=0;o.transitions.length>i;i++)if(s=o.transitions[i],t.util.areEquivalent(s.symbol,o.alphabet[r])&&t.util.areEquivalent(s.fromState,o.states[a])){p=!0;break}p===!1&&(f===!1&&(o.states.push([h]),f=!0),o.transitions.push({fromState:o.states[a],symbol:o.alphabet[r],toStates:[[h]]}))}return o},t.fsm.convertEnfaToNfa=function(e){if(t.fsm.determineType(e)!==t.fsm.enfaType)return e;var n,a,r=t.util.clone(e),i=t.fsm.computeEpsilonClosure(e,[e.initialState]);t.util.containsAny(r.acceptingStates,i)&&!t.util.contains(r.acceptingStates,r.initialState)&&r.acceptingStates.push(r.initialState);var s=[];for(n=0;r.states.length>n;n++)for(a=0;r.alphabet.length>a;a++){var o=t.fsm.makeTransition(r,[r.states[n]],r.alphabet[a]).sort();o.length>0&&s.push({fromState:r.states[n],toStates:o,symbol:r.alphabet[a]})}r.transitions=s;var l=[];for(n=0;r.transitions.length>n;n++){var u=r.transitions[n];if(u.toStates.length>1){var c=!1;for(a=0;l.length>a;a++)if(t.util.areEqualSets(u.toStates,l[a])){u.toStates=l[a],c=!0;break}c===!1&&l.push(u.toStates)}}return r},t.fsm.isLanguageNonEmpty=function(e){var n=t.fsm.determineType(e),a=e;return n===t.fsm.nfaType?a=t.fsm.convertNfaToDfa(e):n===t.fsm.enfaType&&(a=t.fsm.convertEnfaToNfa(e),a=t.fsm.convertNfaToDfa(a)),a=t.fsm.minimize(a),a.acceptingStates.length>0},t.fsm.isLanguageInfinite=function(e){var n=t.fsm.determineType(e),a=e;n===t.fsm.nfaType?a=t.fsm.convertNfaToDfa(e):n===t.fsm.enfaType&&(a=t.fsm.convertEnfaToNfa(e),a=t.fsm.convertNfaToDfa(a)),a=t.fsm.minimize(a);var r,i,s=null;for(r=0;a.states.length>r;r++)if(!t.util.contains(a.acceptingStates,a.states[r])&&(i=t.fsm.getReachableStates(a,a.states[r],!0),!t.util.containsAny(a.acceptingStates,i))){s=a.states[r];break}if(null===s)return!0;for(r=0;a.states.length>r;r++)if(!t.util.areEquivalent(s,a.states[r])&&(i=t.fsm.getReachableStates(a,a.states[r],!1),t.util.contains(i,a.states[r])))return!0;return!1},t.fsm.randomStringInLanguage=function(e){var n=t.fsm.determineType(e),a=e;if(n===t.fsm.nfaType?a=t.fsm.convertNfaToDfa(e):n===t.fsm.enfaType&&(a=t.fsm.convertEnfaToNfa(e),a=t.fsm.convertNfaToDfa(a)),a=t.fsm.minimize(a),0===a.acceptingStates.length)return null;for(var r=a.acceptingStates[Math.floor(Math.random()*a.acceptingStates.length)],i=[];;){if(t.util.areEquivalent(r,a.initialState)===!0&&Math.round(Math.random()))break;var s,o=[];for(s=0;a.transitions.length>s;s++)t.util.areEquivalent(a.transitions[s].toStates[0],r)&&o.push(a.transitions[s]);if(0===o.length)break;var l=o[Math.floor(Math.random()*o.length)];i.push(l.symbol),r=l.fromState}return i.reverse(),i},t.fsm.randomStringNotInLanguage=function(e){var n=t.fsm.determineType(e),a=e;n===t.fsm.nfaType?a=t.fsm.convertNfaToDfa(e):n===t.fsm.enfaType&&(a=t.fsm.convertEnfaToNfa(e),a=t.fsm.convertNfaToDfa(a)),a=t.fsm.minimize(a);var r,i=[];for(r=0;a.states.length>r;r++)t.util.contains(a.acceptingStates,a.states[r])||i.push(a.states[r]);if(0===i.length)return null;for(var s=i[Math.floor(Math.random()*i.length)],o=[];;){if(t.util.areEquivalent(s,a.initialState)===!0&&Math.round(Math.random()))break;var l=[];for(r=0;a.transitions.length>r;r++)t.util.areEquivalent(a.transitions[r].toStates[0],s)&&l.push(a.transitions[r]);if(0===l.length)break;var u=l[Math.floor(Math.random()*l.length)];o.push(u.symbol),s=u.fromState}return o.reverse(),o},t.fsm.union=function(e,n){if(!t.util.areEquivalent(e.alphabet,n.alphabet))throw Error("Alphabets must be the same");var a,r,i,s={alphabet:t.util.clone(e.alphabet),states:[],initialState:[t.util.clone(e.initialState),t.util.clone(n.initialState)],acceptingStates:[],transitions:[]};for(a=0;e.states.length>a;a++)for(r=0;n.states.length>r;r++){var o=[t.util.clone(e.states[a]),t.util.clone(n.states[r])];for(s.states.push(o),(t.util.contains(e.acceptingStates,e.states[a])||t.util.contains(n.acceptingStates,n.states[r]))&&s.acceptingStates.push(o),i=0;s.alphabet.length>i;i++)s.transitions.push({fromState:o,symbol:s.alphabet[i],toStates:[[t.fsm.makeTransition(e,[e.states[a]],s.alphabet[i])[0],t.fsm.makeTransition(n,[n.states[r]],s.alphabet[i])[0]]]})}return s},t.fsm.intersection=function(e,n){var a,r,i,s=t.util.clone(t.util.setIntersection(e.alphabet,n.alphabet)),o={alphabet:s,states:[],initialState:[t.util.clone(e.initialState),t.util.clone(n.initialState)],acceptingStates:[],transitions:[]};for(a=0;e.states.length>a;a++)for(r=0;n.states.length>r;r++){var l=[t.util.clone(e.states[a]),t.util.clone(n.states[r])];for(o.states.push(l),t.util.contains(e.acceptingStates,e.states[a])&&t.util.contains(n.acceptingStates,n.states[r])&&o.acceptingStates.push(l),i=0;o.alphabet.length>i;i++)o.transitions.push({fromState:l,symbol:o.alphabet[i],toStates:[[t.fsm.makeTransition(e,[e.states[a]],o.alphabet[i])[0],t.fsm.makeTransition(n,[n.states[r]],o.alphabet[i])[0]]]})}return o},t.fsm.difference=function(e,n){if(!t.util.areEquivalent(e.alphabet,n.alphabet))throw Error("Alphabets must be the same");var a,r,i,s={alphabet:t.util.clone(e.alphabet),states:[],initialState:[t.util.clone(e.initialState),t.util.clone(n.initialState)],acceptingStates:[],transitions:[]};for(a=0;e.states.length>a;a++)for(r=0;n.states.length>r;r++){var o=[t.util.clone(e.states[a]),t.util.clone(n.states[r])];for(s.states.push(o),t.util.contains(e.acceptingStates,e.states[a])&&!t.util.contains(n.acceptingStates,n.states[r])&&s.acceptingStates.push(o),i=0;s.alphabet.length>i;i++)s.transitions.push({fromState:o,symbol:s.alphabet[i],toStates:[[t.fsm.makeTransition(e,[e.states[a]],s.alphabet[i])[0],t.fsm.makeTransition(n,[n.states[r]],s.alphabet[i])[0]]]})}return s},t.fsm.complement=function(e){var n,a=t.util.clone(e),r=[];for(n=0;a.states.length>n;n++)t.util.contains(a.acceptingStates,a.states[n])||r.push(a.states[n]);return a.acceptingStates=r,a},t.fsm.concatenation=function(e,n){if(!t.util.areEquivalent(e.alphabet,n.alphabet))throw Error("Alphabets must be the same");if(t.util.containsAny(e.states,n.states))throw Error("States must not overlap");for(var a={alphabet:t.util.clone(e.alphabet),states:t.util.clone(e.states).concat(t.util.clone(n.states)),initialState:t.util.clone(e.initialState),acceptingStates:t.util.clone(n.acceptingStates),transitions:t.util.clone(e.transitions).concat(t.util.clone(n.transitions))},r=0;e.acceptingStates.length>r;r++)a.transitions.push({fromState:t.util.clone(e.acceptingStates[r]),toStates:[t.util.clone(n.initialState)],symbol:t.fsm.epsilonSymbol});return a},t.fsm.kleene=function(e){var n=t.util.clone(e),a="NEW_INITIAL";n.states.push(a),n.transitions.push({fromState:a,toStates:[n.initialState],symbol:t.fsm.epsilonSymbol}),n.initialState=a;for(var r=0;n.acceptingStates.length>r;r++)n.transitions.push({fromState:n.acceptingStates[r],toStates:[a],symbol:t.fsm.epsilonSymbol});return n},t.fsm.reverse=function(e){for(var n=t.util.clone(e),a=[],r=0;n.transitions.length>r;r++)for(var i=0;n.transitions[r].toStates.length>i;i++)a.push({fromState:n.transitions[r].toStates[i],toStates:[n.transitions[r].fromState],symbol:n.transitions[r].symbol});n.transitions=a;var s=n.acceptingStates;n.acceptingStates=[n.initialState];var o="NEW_INITIAL";return n.states.push(o),n.initialState=o,n.transitions.push({fromState:o,toStates:s,symbol:t.fsm.epsilonSymbol}),n},t.fsm.isSubset=function(e,n){var a=t.fsm.intersection(e,n);return t.fsm.areEquivalentFSMs(n,a)},t.fsm.grammar=function(e){var n,a={nonterminals:t.util.clone(e.states),terminals:t.util.clone(e.alphabet),initialNonterminal:t.util.clone(e.initialState),productions:[]};for(n=0;e.transitions.length>n;n++)e.transitions[n].symbol===t.fsm.epsilonSymbol?a.productions.push({left:[t.util.clone(e.transitions[n].fromState)],right:t.util.clone(e.transitions[n].toStates)}):a.productions.push({left:[t.util.clone(e.transitions[n].fromState)],right:[t.util.clone(e.transitions[n].symbol)].concat(t.util.clone(e.transitions[n].toStates))});for(n=0;e.acceptingStates.length>n;n++)a.productions.push({left:[t.util.clone(e.acceptingStates[n])],right:[t.grammar.epsilonSymbol]});return a},t.fsm.symbolsForTransitions=function(e,n,a){for(var r=[],i=0;e.transitions.length>i;i++){var s=e.transitions[i];
t.util.areEquivalent(s.fromState,n)&&t.util.contains(s.toStates,a)&&r.push(s.symbol)}return r},t.fsm.toRegex=function(e){var n,a,r,i,s=[],o=e.states.length;for(r=0;o+1>r;r++)for(s[r]=[],n=0;o>n;n++)s[r][n]=[];for(n=0;o>n;n++)for(a=0;o>a;a++){var l=t.fsm.symbolsForTransitions(e,e.states[n],e.states[a]);for(i=0;l.length>i;i++)l[i]=t.re.tree.makeLit(l[i]);n===a&&l.push(t.re.tree.makeEps()),s[0][n][a]=t.re.tree.makeAlt(l)}for(r=1;o+1>r;r++)for(n=0;o>n;n++)for(a=0;o>a;a++)s[r][n][a]=t.re.tree.makeAlt([s[r-1][n][a],t.re.tree.makeSeq([s[r-1][n][r-1],t.re.tree.makeKStar(s[r-1][r-1][r-1]),s[r-1][r-1][a]])]);var u=-1,c=[];for(n=0;e.states.length>n;n++)t.util.areEquivalent(e.states[n],e.initialState)&&(u=n),t.util.contains(e.acceptingStates,e.states[n])&&c.push(n);var f=[];for(n=0;c.length>n;n++)f.push(s[o][u][c[n]]);return t.re.tree.makeAlt(f)},t.grammar={},t.grammar.epsilonSymbol="$",t.grammar.regType="regular",t.grammar.cfgType="context-free",t.grammar.csgType="context-sensitive",t.grammar.unrestrictedType="unrestricted",t.grammar.validate=function(e){if(!(e!==void 0&&Array.isArray(e.nonterminals)&&Array.isArray(e.terminals)&&e.initialNonterminal!==void 0&&null!==e.initialNonterminal&&Array.isArray(e.productions)))throw Error("Grammar must be defined and have nonterminals, terminals, initialNonterminal and productions array properties!");var n,a;if(1>e.nonterminals.length)throw Error("Set of nonterminals must not be empty.");if(1>e.terminals.length)throw Error("Set of terminals must not be empty.");for(n=0;e.nonterminals.length>n;n++)if(t.util.contains(e.nonterminals,e.nonterminals[n],n+1))throw Error("Equivalent nonterminals");for(n=0;e.terminals.length>n;n++)if(t.util.contains(e.terminals,e.terminals[n],n+1))throw Error("Equivalent terminals");for(n=0;e.terminals.length>n;n++)if(t.util.contains(e.nonterminals,e.terminals[n]))throw Error("Terminals and nonterminals must not overlap");if(!t.util.contains(e.nonterminals,e.initialNonterminal))throw Error("InitialNonterminal must be in nonterminals");for(n=0;e.productions.length>n;n++){var r=e.productions[n];if(!Array.isArray(r.left))throw Error("Left side of production must be an array");if(0===r.left.length)throw Error("Left side of production must have at least one terminal or nonterminal");for(a=0;r.left.length>a;a++)if(!t.util.contains(e.nonterminals,r.left[a])&&!t.util.contains(e.terminals,r.left[a]))throw Error("Left side of production must be in nonterminals or terminals");if(!Array.isArray(r.right))throw Error("Right side of production must be an array");if(1===r.right.length&&r.right[0]===t.grammar.epsilonSymbol);else{if(0===r.right.length)throw Error("Right side of production must have at least one terminal or nonterminal or epsilon symbol");for(a=0;r.right.length>a;a++)if(!t.util.contains(e.nonterminals,r.right[a])&&!t.util.contains(e.terminals,r.right[a]))throw Error("Right side of production must be in nonterminals or terminals")}if(t.util.contains(e.productions,r,n+1))throw Error("Grammar must not have duplicate productions")}return!0},t.grammar.determineType=function(e){var n,a,r,i=t.grammar.regType,s=null;for(n=0;e.productions.length>n;n++){var o=e.productions[n];if(i===t.grammar.regType)if(1===o.left.length&&t.util.contains(e.nonterminals,o.left[0])){if(1===o.right.length)continue;var l=0;for(r=-1,a=0;o.right.length>a;a++)t.util.contains(e.nonterminals,o.right[a])&&(l+=1,r=a);if(l>1)i=t.grammar.cfgType;else{if(0===l)continue;if(0===r){if(null===s){s=!1;continue}if(s===!1)continue;s===!0&&(i=t.grammar.cfgType)}else if(r===o.right.length-1){if(null===s){s=!0;continue}if(s===!0)continue;s===!1&&(i=t.grammar.cfgType)}else i=t.grammar.cfgType}}else i=t.grammar.cfgType;if(i===t.grammar.cfgType&&(1===o.left.length&&t.util.contains(e.nonterminals,o.left[0])||(i=t.grammar.csgType)),i===t.grammar.csgType){var u=0;for(r=-1,a=0;o.left.length>a;a++)t.util.contains(e.nonterminals,o.left[a])&&(u+=1,r=a);if(u>1)return t.grammar.unrestrictedType;var c=o.left.slice(0,r-1),f=o.left.slice(r);for(a=0;c.length>a;a++)if(!t.util.areEquivalent(c[a],o.right[a]))return t.grammar.unrestrictedType;for(a=0;f.length>a;a++)if(!t.util.areEquivalent(f[f.length-a-1],o.right[o.right.length-a-1]))return t.grammar.unrestrictedType;if(o.right.length<=c.length+f.length)return t.grammar.unrestrictedType}}return i},t.grammar.printAscii=function(e){var n=[];n.push("Initial nonterminal: <"+e.initialNonterminal+">");var a,r,i,s=[];for(a=0;e.productions.length>a;a++){var o=-1;for(r=0;s.length>r;r++)if(t.util.areEquivalent(s[r][0],e.productions[a].left)){o=r;break}-1===o?s[s.length]=[e.productions[a].left,[e.productions[a].right]]:s[o][1].push(e.productions[a].right)}for(a=0;s.length>a;a++){var l=[];for(r=0;s[a][0].length>r;r++)t.util.contains(e.nonterminals,s[a][0][r])?l.push("<"+(""+s[a][0][r])+">"):s[a][0][r]===t.grammar.epsilonSymbol?l.push(""+s[a][0][r]):l.push('"'+(""+s[a][0][r])+'"');for(l.push("->"),r=0;s[a][1].length>r;r++){for(i=0;s[a][1][r].length>i;i++)t.util.contains(e.nonterminals,s[a][1][r][i])?l.push("<"+(""+s[a][1][r][i])+">"):s[a][1][r][i]===t.grammar.epsilonSymbol?l.push(""+s[a][1][r][i]):l.push('"'+(""+s[a][1][r][i])+'"');s[a][1].length-1>r&&l.push("|")}n.push(l.join(" "))}return n.join("\n")},t.re=function(){var e=function(){function e(t,e){var n;for(n in t)t.hasOwnProperty(n)&&delete t[n];for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}function n(t){return t.tag===ne.SEQ&&1===t.elements.length?(t.tag=t.elements[0].tag,e(t,t.elements[0]),!0):!1}function a(t){return t.tag===ne.ALT&&1===t.choices.length?(t.tag=t.choices[0].tag,e(t,t.choices[0]),!0):!1}function r(t){return t.tag===ne.KSTAR&&t.expr.tag===ne.EPS?(t.tag=t.expr.tag,delete t.expr,!0):!1}function i(t){return t.tag===ne.KSTAR&&t.expr.tag===ne.KSTAR?(t.expr=t.expr.expr,!0):!1}function s(t){if(t.tag===ne.KSTAR&&t.expr.tag===ne.ALT)for(var e=0;t.expr.choices.length>e;e++)if(t.expr.choices[e].tag===ne.KSTAR)return t.expr.choices[e]=t.expr.choices[e].expr,!0;return!1}function o(t){if(t.tag===ne.ALT&&t.choices.length>=2){for(var e=-1,n=-1,a=0;t.choices.length>a;a++)t.choices[a].tag===ne.EPS?e=a:t.choices[a].tag===ne.KSTAR&&(n=a);if(e>=0&&n>=0)return t.choices.splice(e,1),!0}return!1}function l(t){if(t.tag===ne.KSTAR&&t.expr.tag===ne.SEQ&&t.expr.elements.length>0){for(var e=!0,n=0;t.expr.elements.length>n;n++)if(t.expr.elements[n].tag!==ne.KSTAR){e=!1;break}if(e)return t.expr.tag=ne.ALT,t.expr.choices=t.expr.elements,delete t.expr.elements,!0}return!1}function u(t){if(t.tag===ne.SEQ&&t.elements.length>=2){for(var e=-1,n=0;t.elements.length>n;n++)t.elements[n].tag===ne.EPS&&(e=n);if(e>=0)return t.elements.splice(e,1),!0}return!1}function c(t){if(t.tag===ne.ALT&&t.choices.length>=2){var e,n=-1;for(e=0;t.choices.length>e;e++)t.choices[e].tag===ne.ALT&&(n=e);if(n>=0){var a=t.choices[n];for(t.choices.splice(n,1),e=0;a.choices.length>e;e++)t.choices.splice(n+e,0,a.choices[e]);return!0}}return!1}function f(t){if(t.tag===ne.SEQ&&t.elements.length>=2){var e,n=-1;for(e=0;t.elements.length>e;e++)if(t.elements[e].tag===ne.SEQ){n=e;break}if(n>=0){var a=t.elements[e];for(t.elements.splice(e,1),e=0;a.elements.length>e;e++)t.elements.splice(n+e,0,a.elements[e]);return!0}}return!1}function h(e){if(e.tag===ne.ALT&&e.choices.length>=2)for(var n=0;e.choices.length-1>n;n++){for(var a=-1,r=n+1;e.choices.length>r;r++)if(t.util.areEquivalent(e.choices[n],e.choices[r])){a=r;break}if(a>=0)return e.choices.splice(a,1),!0}return!1}function p(e){if(e.tag===ne.ALT&&e.choices.length>=2)for(var n=0;e.choices.length-1>n;n++){for(var a=-1,r=n+1;e.choices.length>r;r++){if(e.choices[r].tag===ne.KSTAR&&t.util.areEquivalent(e.choices[r].expr,e.choices[n])){a=n;break}if(e.choices[n].tag===ne.KSTAR&&t.util.areEquivalent(e.choices[n].expr,e.choices[r])){a=r;break}}if(a>=0)return e.choices.splice(a,1),!0}return!1}function m(e){if(e.tag===ne.SEQ&&e.elements.length>=2){for(var n=-1,a=0;e.elements.length-1>a;a++)if(e.elements[a].tag===ne.KSTAR&&e.elements[a+1].tag===ne.KSTAR&&t.util.areEquivalent(e.elements[a],e.elements[a+1])){n=a;break}if(n>=0)return e.elements.splice(n+1,1),!0}return!1}function g(e){if(e.tag===ne.KSTAR&&e.expr.tag===ne.ALT&&e.expr.choices.length>=2)for(var n=0;e.expr.choices.length>n;n++)for(var a=0;e.expr.choices.length>a;a++)if(n!==a&&e.expr.choices[a].tag===ne.SEQ&&e.expr.choices[a].elements.length>=2){for(var r=!0,i=0;e.expr.choices[a].elements.length>i;i++)if(!t.util.areEquivalent(e.expr.choices[n],e.expr.choices[a].elements[i])){r=!1;break}if(r)return e.expr.choices.splice(a,1),!0}return!1}function S(t){if(t.tag===ne.KSTAR&&t.expr.tag===ne.ALT&&t.expr.choices.length>=2)for(var e=0;t.expr.choices.length>e;e++)if(t.expr.choices[e].tag===ne.EPS)return t.expr.choices.splice(e,1),!0;return!1}function v(e){if(e.tag===ne.ALT&&e.choices.length>=2)for(var n=0;e.choices.length-1>n;n++)if(e.choices[n].tag===ne.SEQ&&e.choices[n].elements.length>=2)for(var a=n+1;e.choices.length>a;a++)if(e.choices[a].tag===ne.SEQ&&e.choices[a].elements.length>=2&&t.util.areEquivalent(e.choices[a].elements[0],e.choices[n].elements[0])){var r=e.choices[n].elements[0],i=_(e.choices[n].elements.slice(1)),s=_(e.choices[a].elements.slice(1)),o=N([i,s]),l=_([r,o]);return e.choices[n]=l,e.choices.splice(a,1),!0}return!1}function d(e){if(e.tag===ne.SEQ&&e.elements.length>=3)for(var n=1;e.elements.length-1>n;n++)if(e.elements[n-1].tag===ne.KSTAR&&e.elements[n+1].tag===ne.KSTAR&&t.util.areEquivalent(e.elements[n-1],e.elements[n+1])&&t.util.areEquivalent(e.elements[n-1].expr,e.elements[n]))return e.elements.splice(n-1,1),!0;return!1}function b(e){if(e.tag===ne.ALT&&e.choices.length>=2)for(var n=0;e.choices.length-1>n;n++)if(e.choices[n].tag===ne.SEQ&&e.choices[n].elements.length>=2)for(var a=n+1;e.choices.length>a;a++)if(e.choices[a].tag===ne.SEQ&&e.choices[a].elements.length>=2&&t.util.areEquivalent(e.choices[a].elements[e.choices[a].elements.length-1],e.choices[n].elements[e.choices[n].elements.length-1])){var r=e.choices[n].elements[e.choices[n].elements.length-1],i=_(e.choices[n].elements.slice(0,e.choices[n].elements.length-1)),s=_(e.choices[a].elements.slice(0,e.choices[a].elements.length-1)),o=N([i,s]),l=_([o,r]);return e.choices[n]=l,e.choices.splice(a,1),!0}return!1}function y(e,n){if(e.tag===ne.ALT&&e.choices.length>=2){var a=[];a.push(E(e.choices[0],n));for(var r=-1,i=0;e.choices.length-1>i;i++)for(var s=i+1;e.choices.length>s;s++){s>=a.length&&a.push(E(e.choices[s],n));try{t.fsm.isSubset(a[i],a[s])&&(r=s)}catch(o){}try{t.fsm.isSubset(a[s],a[i])&&(r=i)}catch(o){}if(r>=0)return e.choices.splice(r,1),!0}}return!1}function T(e,n){if(e.tag===ne.KSTAR&&e.expr.tag===ne.ALT&&e.expr.choices.length>=2){var a=[];a.push(E(M(e.expr.choices[0]),n));for(var r=-1,i=0;e.expr.choices.length-1>i;i++)for(var s=i+1;e.expr.choices.length>s;s++){s>=a.length&&a.push(E(M(e.expr.choices[s]),n));try{t.fsm.isSubset(a[i],a[s])&&(r=s)}catch(o){}try{t.fsm.isSubset(a[s],a[i])&&(r=i)}catch(o){}if(r>=0)return e.expr.choices.splice(r,1),!0}}return!1}function E(e,n){var a=n.get(e);return a||(a=t.fsm.minimize(t.re.tree.toAutomaton(e)),n.put(e,a)),a}function A(e,n){if(e.tag===ne.SEQ&&e.elements.length>=2){var a=[];a.push(E(e.elements[0],n));for(var r=-1,i=0;e.elements.length-1>i;i++)if(a.push(E(e.elements[i+1],n)),e.elements[i].tag===ne.KSTAR&&e.elements[i+1].tag===ne.KSTAR){try{t.fsm.isSubset(a[i],a[i+1])&&(r=i+1)}catch(s){}try{t.fsm.isSubset(a[i+1],a[i])&&(r=i)}catch(s){}if(r>=0)return e.elements.splice(r,1),!0}}return!1}function x(e,n){if(e.tag===ne.ALT&&e.choices.length>1){var a=t.util.index(e.choices,K());if(a>=0)for(var r=0;e.choices.length>r;r++)if(e.choices[r].tag!==ne.EPS){var i=E(e.choices[r],n);if(t.fsm.isAcceptingState(i,i.initialState))return e.choices.splice(a,1),!0}}return!1}function w(e){if(e.tag===ne.SEQ&&e.elements.length>1)for(var n=0;e.elements.length-1>n;n++)if(e.elements[n].tag===ne.KSTAR&&e.elements[n+1].tag===ne.ALT&&2===e.elements[n+1].choices.length){var a=t.util.index(e.elements[n+1].choices,K());if(a>=0){var r=0===a?e.elements[n+1].choices[1]:e.elements[n+1].choices[0];if(r.tag===ne.SEQ&&2===r.elements.length&&r.elements[1].tag===ne.KSTAR&&r.elements[1].expr.tag===ne.ALT&&2===r.elements[1].expr.choices.length&&t.util.contains(r.elements[1].expr.choices,e.elements[n].expr)&&t.util.contains(r.elements[1].expr.choices,r.elements[0]))return e.elements[n+1]=r.elements[1],e.elements.splice(n,1),!0}}return!1}function k(e){if(e.tag===ne.SEQ&&e.elements.length>1)for(var n=1;e.elements.length>n;n++)if(e.elements[n].tag===ne.KSTAR&&e.elements[n-1].tag===ne.ALT&&2===e.elements[n-1].choices.length){var a=t.util.index(e.elements[n-1].choices,K());if(a>=0){var r=0===a?e.elements[n-1].choices[1]:e.elements[n-1].choices[0];if(r.tag===ne.SEQ&&2===r.elements.length&&r.elements[0].tag===ne.KSTAR&&r.elements[0].expr.tag===ne.ALT&&2===r.elements[0].expr.choices.length&&t.util.contains(r.elements[0].expr.choices,e.elements[n].expr)&&t.util.contains(r.elements[0].expr.choices,r.elements[1]))return e.elements[n-1]=r.elements[0],e.elements.splice(n,1),!0}}return!1}function R(e,n){var a=t.util.clone(e);n===void 0&&(n={});var r=t.util.clone(n);r.numIterations===void 0&&(r.numIterations=null),r.appliedPatterns=r.appliedPatterns===void 0?null:n.appliedPatterns,r.useFsmPatterns===void 0&&(r.useFsmPatterns=!0);for(var i="temp",s=0,o=new t.util.HashTable;null!==i&&(null===r.numIterations||r.numIterations>s);)i=L(a,o,r.useFsmPatterns),null!==i&&null!==r.appliedPatterns&&r.appliedPatterns.push(i),s+=1;return a}function L(t,e,n){for(var a=null,r=null,i=0;ae.length>i;i++)if(a=ae[i],(n!==!1||"fsm"!==a.type)&&(r=q(t,a["function"],e)))return a.pattern;return null}function q(t,e,n){var a=e(t,n);if(a)return a;var r=[];t.tag===ne.ALT?r=t.choices:t.tag===ne.SEQ?r=t.elements:t.tag===ne.KSTAR&&(r=[t.expr]);for(var i=0;r.length>i;i++)if(a=q(r[i],e,n))return a;return!1}function N(t){return{tag:ne.ALT,choices:t}}function _(t){return{tag:ne.SEQ,elements:t}}function M(t){return{tag:ne.KSTAR,expr:t}}function P(t){return{tag:ne.LIT,obj:t}}function K(){return re}function I(e,n,a){for(var r=t.fsm.addState(n,a.getAndAdvance()),i=t.fsm.addState(n,a.getAndAdvance()),s=0;e.choices.length>s;s++){var o=O(e.choices[s],n,a);t.fsm.addEpsilonTransition(n,r,[o[0]]),t.fsm.addEpsilonTransition(n,o[1],[i])}return[r,i]}function F(e,n,a){for(var r,i,s,o=0;e.elements.length>o;o++)s=O(e.elements[o],n,a),0===o?r=s[0]:t.fsm.addEpsilonTransition(n,i,[s[0]]),i=s[1];return void 0===r&&(r=t.fsm.addState(n,a.getAndAdvance()),i=t.fsm.addState(n,a.getAndAdvance())),[r,i]}function H(e,n,a){var r=t.fsm.addState(n,a.getAndAdvance()),i=t.fsm.addState(n,a.getAndAdvance()),s=O(e.expr,n,a),o=s[0],l=s[1];return t.fsm.addEpsilonTransition(n,r,[i]),t.fsm.addEpsilonTransition(n,r,[o]),t.fsm.addEpsilonTransition(n,l,[o]),t.fsm.addEpsilonTransition(n,l,[i]),[r,i]}function j(e,n,a){var r=t.fsm.addState(n,a.getAndAdvance()),i=t.fsm.addState(n,a.getAndAdvance());try{t.fsm.addSymbol(n,e.obj)}catch(s){}return t.fsm.addTransition(n,r,[i],e.obj),[r,i]}function Q(e,n,a){var r=t.fsm.addState(n,a.getAndAdvance()),i=t.fsm.addState(n,a.getAndAdvance());return t.fsm.addEpsilonTransition(n,r,[i]),[r,i]}function O(t,e,n){return ie[t.tag](t,e,n)}function D(e){var n=t.fsm.makeNew(),a=O(e,n,t.util.makeCounter(0));return t.fsm.setInitialState(n,a[0]),t.fsm.addAcceptingState(n,a[1]),n}function $(t,e){return se[t.tag]>=se[e.tag]}function C(e,n,a){var r=$(e,n);r&&a.push(t.re.array.specials.LEFT_PAREN),V(n,a),r&&a.push(t.re.array.specials.RIGHT_PAREN)}function G(t,e,n,a){for(var r=0;n.length>r;r++)void 0!==a&&r>0&&e.push(a),C(t,n[r],e)}function z(e,n){G(e,n,e.choices,t.re.array.specials.ALT)}function B(t,e){G(t,e,t.elements)}function U(e,n){C(e,e.expr,n),n.push(t.re.array.specials.KSTAR)}function J(t,e){e.push(t.obj)}function W(e,n){n.push(t.re.array.specials.EPS)}function V(t,e){return oe[t.tag](t,e)}function X(t){var e=[];return V(t,e),e}function Y(e){return t.re.array.toString(X(e))}function Z(t,e,n){var a=.5,r=.1,i=.1;return n&&(n.ALT_PROB&&(a=n.ALT_PROB),n.KLEENE_PROB&&(r=n.KLEENE_PROB),n.EPS_PROB&&(i=n.EPS_PROB)),te(t,e,a,r,i)}function te(t,e,n,a,r){var i=ee(t,e,n,a,r);return a>=Math.random()&&(i=M(i)),i}function ee(e,n,a,r,i){if(0===e)return K();if(1==e)return P(n[t.util.randint(0,n.length-1)]);if(i>=Math.random())return N([K(),te(e,n,a,r,i)]);var s=t.util.randint(1,e-1),o=te(s,n,a,r,i),l=te(e-s,n,a,r,i);return a>=Math.random()?N([o,l]):_([o,l])}var ne={ALT:"alt",SEQ:"sequence",KSTAR:"kleene_star",LIT:"literal",EPS:"epsilon"},ae=[];ae.push({pattern:"(a) => a",type:"structure","function":n}),ae.push({pattern:"(a) => a",type:"structure","function":a}),ae.push({pattern:"$* => $",type:"structure","function":r}),ae.push({pattern:"(a*)* => a*",type:"structure","function":i}),ae.push({pattern:"(a+b*)* => (a+b)*",type:"structure","function":s}),ae.push({pattern:"$+a* => a*",type:"structure","function":o}),ae.push({pattern:"(a*b*)* => (a*+b*)*",type:"structure","function":l}),ae.push({pattern:"$a => a",type:"structure","function":u}),ae.push({pattern:"a+a => a",type:"structure","function":h}),ae.push({pattern:"a+a* => a*",type:"structure","function":p}),ae.push({pattern:"a*a* => a*",type:"structure","function":m}),ae.push({pattern:"(aa+a)* => (a)*",type:"structure","function":g}),ae.push({pattern:"(a + $)* => (a)*",type:"structure","function":S}),ae.push({pattern:"(ab+ac) => a(b+c)",type:"structure","function":v}),ae.push({pattern:"a*aa* => aa*",type:"structure","function":d}),ae.push({pattern:"(ab+cb) => (a+c)b",type:"structure","function":b}),ae.push({pattern:"a*($+b(a+b)*) => (a+b)*",type:"structure","function":w}),ae.push({pattern:"($+(a+b)*a)b* => (a+b)*",type:"structure","function":k}),ae.push({pattern:"$+L => L, if L contains $",type:"fsm","function":x}),ae.push({pattern:"L1+L2 => L2, if L1 is subset of L2",type:"fsm","function":y}),ae.push({pattern:"(L1+L2)* => L2, if L1* is subset of L2*",type:"fsm","function":T}),ae.push({pattern:"L1*L2* => L2, if L1* is subset of L2*",type:"fsm","function":A}),ae.push({pattern:"ab(cd) => abcd",type:"structure","function":f}),ae.push({pattern:"(a+(b+c)) => a+b+c",type:"structure","function":c});var re={tag:ne.EPS},ie={};ie[ne.ALT]=I,ie[ne.SEQ]=F,ie[ne.KSTAR]=H,ie[ne.LIT]=j,ie[ne.EPS]=Q;var se={};se[ne.ALT]=0,se[ne.SEQ]=1,se[ne.KSTAR]=2,se[ne.LIT]=3,se[ne.EPS]=3;var oe={};return oe[ne.ALT]=z,oe[ne.SEQ]=B,oe[ne.KSTAR]=U,oe[ne.LIT]=J,oe[ne.EPS]=W,{tags:ne,makeAlt:N,makeSeq:_,makeKStar:M,makeLit:P,makeEps:K,toAutomaton:D,toArray:X,toString:Y,random:Z,simplify:R}}(),n=function(){function e(t,e){this.name="RegexError",this.message=t,this.position=e}function n(){return this.arr[this.idx]}function a(){++this.idx}function r(t){return{arr:t,idx:0,peek:n,advance:a}}function i(n){if(0===n.length)return t.re.tree.makeSeq([]);var a=r(n),i=c(a);if(void 0!==a.peek())throw new e("Malformed regex array: successfully parsed up to position "+a.idx,a.idx);return i}function s(t){return t===S.ALT||t===S.KSTAR||t===S.LEFT_PAREN||t===S.RIGHT_PAREN||t===S.EPS?""+t:void 0}function o(e){for(var n=t.re.string.escapable,a=0;n.length>a;a++)if(e===n[a])return"\\"+e;return e}function l(t){for(var n,a=[],r=!1,i=0;t.length>i;i++){if(n=t[i],"string"==typeof n?1!==n.length?r=!0:n=o(n):(n=s(n),void 0===n&&(r=!0)),r)throw new e("Array regex not convertible to string representation: failed at position "+i,i);a.push(n)}return a.join("")}function u(e){var n=t.re.array.toTree(e);return t.re.tree.toAutomaton(n)}function c(e){for(var n=[];;){if(n.push(f(e)),e.peek()!==S.ALT)break;e.advance()}return t.re.tree.makeAlt(n)}function f(n){for(var a,r=[];;){if(a=h(n),void 0===a)break;r.push(a)}if(0===r.length)throw new e("Malformed regex array: empty choice subexpression at index "+n.idx,n.idx);return t.re.tree.makeSeq(r)}function h(e){var n=p(e);return e.peek()===S.KSTAR&&(e.advance(),n=t.re.tree.makeKStar(n)),n}function p(n){if(n.peek()===S.LEFT_PAREN){n.advance();var a=c(n);if(n.peek()!==S.RIGHT_PAREN)throw new e("Malformed regex array: missing matching right parenthesis at index "+n.idx,n.idx);return n.advance(),a}if(n.peek()===S.EPS)return n.advance(),t.re.tree.makeEps();if(void 0===n.peek()||n.peek()===S.ALT||n.peek()===S.RIGHT_PAREN)return void 0;if(n.peek()===S.KSTAR)throw new e("Malformed regex array: empty subexpression before Kleene star at index "+n.idx,n.idx);var r=t.re.tree.makeLit(n.peek());return n.advance(),r}function m(e,n,a){return t.re.tree.toArray(t.re.tree.random(e,n,a))}function g(e,n,a){var r=t.re.array.toTree(e),i=t.re.tree.simplify(r,n,a);return t.re.tree.toArray(i)}var S={ALT:{},KSTAR:{},LEFT_PAREN:{},RIGHT_PAREN:{},EPS:{}};return S.ALT.toString=function(){return"+"},S.KSTAR.toString=function(){return"*"},S.LEFT_PAREN.toString=function(){return"("},S.RIGHT_PAREN.toString=function(){return")"},S.EPS.toString=function(){return"$"},e.prototype=Error(),{specials:S,toTree:i,toString:l,toAutomaton:u,random:m,simplify:g}}(),a=function(){function e(e){for(var n,a=[],r=!1,i=t.re.array.specials,o=0;e.length>o;++o)if(r){if(-1===s.indexOf(e[o]))throw new RegexError("Malformed string regex: illegal escape sequence \\"+e[o],o);a.push(e[o]),r=!1}else if("\\"===e[o])r=!0;else{switch(n=e[o]){case"$":n=i.EPS;break;case"+":n=i.ALT;break;case"*":n=i.KSTAR;break;case"(":n=i.LEFT_PAREN;break;case")":n=i.RIGHT_PAREN}a.push(n)}if(r)throw new RegexError("Malformed string regex: unfinished escape sequence at end of string",e.length-1);return a}function n(e){var n=t.re.string.toArray(e);return t.re.array.toTree(n)}function a(e){var n=t.re.string.toTree(e);return t.re.tree.toAutomaton(n)}function r(e,n,a){for(var r=[],i=0;n.length>i;i++)r.push(n.charAt(i));return t.re.tree.toString(t.re.tree.random(e,r,a))}function i(e,n,a){var r=t.re.string.toTree(e),i=t.re.tree.simplify(r,n,a);return t.re.tree.toString(i)}var s="$+*()\\";return{escapable:s,toArray:e,toTree:n,toAutomaton:a,random:r,simplify:i}}();return{tree:e,array:n,string:a}}(),t}());